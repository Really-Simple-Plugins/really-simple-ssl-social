define("ace/keyboard/vim",["require","exports","module","ace/range","ace/lib/event_emitter","ace/lib/dom","ace/lib/oop","ace/lib/keys","ace/lib/event","ace/search","ace/lib/useragent","ace/search_highlight","ace/commands/multi_select_commands","ace/mode/text","ace/multi_select"],function(bY,bD,bL){function bG(){function b(g){return typeof g!="object"?g+"":"line" in g?g.line+":"+g.ch:"anchor" in g?b(g.anchor)+"->"+b(g.head):Array.isArray(g)?"["+g.map(function(h){return b(h)})+"]":JSON.stringify(g)}var d="";for(var f=0;f<arguments.length;f++){var c=arguments[f],a=b(c);d+=a+"  "}console.log(d)}function bN(a){return{row:a.line,column:a.ch}}function bW(a){return new cE(a.row,a.column)}function by(a){a.setOption("disableInput",!0),a.setOption("showCursorWhenSelecting",!1),bB.signal(a,"vim-mode-change",{mode:"normal"}),a.on("cursorActivity",c1),aL(a),bB.on(a.getInputField(),"paste",cp(a))}function cd(a){a.setOption("disableInput",!1),a.off("cursorActivity",c1),bB.off(a.getInputField(),"paste",cp(a)),a.state.vim=null}function co(b,a){this==bB.keyMap.vim&&bB.rmClass(b.getWrapperElement(),"cm-fat-cursor"),(!a||a.attach!=cH)&&cd(b)}function cH(b,a){this==bB.keyMap.vim&&bB.addClass(b.getWrapperElement(),"cm-fat-cursor"),(!a||a.attach!=cH)&&by(b)}function bQ(c,a){if(!a){return undefined}if(this[c]){return this[c]}var d=cm(c);if(!d){return !1}var b=bB.Vim.findKey(a,d);return typeof b=="function"&&bB.signal(a,"vim-keypress",d),b}function cm(f){if(f.charAt(0)=="'"){return f.charAt(1)}var b=f.split(/-(?!$)/),g=b[b.length-1];if(b.length==1&&b[0].length==1){return !1}if(b.length==2&&b[0]=="Shift"&&g.length==1){return !1}var d=!1;for(var a=0;a<b.length;a++){var c=b[a];c in cu?b[a]=cu[c]:d=!0,c in cJ&&(b[a]=cJ[c])}return d?(b9(g)&&(b[b.length-1]=g.toLowerCase()),"<"+b.join("-")+">"):!1}function cp(b){var a=b.state.vim;return a.onPasteFn||(a.onPasteFn=function(){a.insertMode||(b.setCursor(c3(b.getCursor(),0,1)),cU.enterInsertMode(b,{},a))}),a.onPasteFn}function cA(c,a){var d=[];for(var b=c;b<c+a;b++){d.push(String.fromCharCode(b))}return d}function ch(b,a){return a>=b.firstLine()&&a<=b.lastLine()}function cc(a){return/^[a-z]$/.test(a)}function bv(a){return"()[]{}".indexOf(a)!=-1}function ca(a){return b4.test(a)}function b9(a){return/^[A-Z]$/.test(a)}function cb(a){return/^\s*$/.test(a)}function cV(b,a){for(var c=0;c<a.length;c++){if(a[c]==b){return !0}}return !1}function cw(f,b,g,d,a){if(b===undefined&&!a){throw Error("defaultValue is required unless callback is provided")}g||(g="string"),cx[f]={type:g,defaultValue:b,callback:a};if(d){for(var c=0;c<d.length;c++){cx[d[c]]=cx[f]}}b&&ci(f,b)}function ci(f,b,g,d){var a=cx[f];d=d||{};var c=d.scope;if(!a){return new Error("Unknown option: "+f)}if(a.type=="boolean"){if(b&&b!==!0){return new Error("Invalid argument: "+f+"="+b)}b!==!1&&(b=!0)}a.callback?(c!=="local"&&a.callback(b,undefined),c!=="global"&&g&&a.callback(b,g)):(c!=="local"&&(a.value=a.type=="boolean"?!!b:b),c!=="global"&&g&&(g.state.vim.options[f]={value:b}))}function cB(f,b,g){var d=cx[f];g=g||{};var a=g.scope;if(!d){return new Error("Unknown option: "+f)}if(d.callback){var c=b&&d.callback(undefined,b);if(a!=="global"&&c!==undefined){return c}if(a!=="local"){return d.callback()}return}var c=a!=="global"&&b&&b.state.vim.options[f];return(c||a!=="local"&&d||{}).value}function bc(){this.latestRegister=undefined,this.isPlaying=!1,this.isRecording=!1,this.replaySearchQueries=[],this.onRecordingDone=undefined,this.lastInsertModeChanges=b6()}function aL(a){return a.state.vim||(a.state.vim={inputState:new bM,lastEditInputState:undefined,lastEditActionCommand:undefined,lastHPos:-1,lastHSPos:-1,lastMotion:null,marks:{},fakeCursor:null,insertMode:!1,insertModeRepeat:undefined,visualMode:!1,visualLine:!1,visualBlock:!1,lastSelection:null,lastPastedText:null,sel:{},options:{}}),a.state.vim}function a6(){cl={searchQuery:null,searchIsReversed:!1,lastSubstituteReplacePart:undefined,jumpList:b8(),macroModeState:new bc,lastCharacterSearch:{increment:0,forward:!0,selectedCharacter:""},registerController:new cZ({}),searchHistoryController:new bx,exCommandHistoryController:new bx};for(var b in cx){var a=cx[b];a.value=a.defaultValue}}function bM(){this.prefixRepeat=[],this.motionRepeat=[],this.operator=null,this.operatorArgs=null,this.motion=null,this.motionArgs=null,this.keyBuffer=[],this.registerName=null}function aB(b,a){b.state.vim.inputState=new bM,bB.signal(b,"vim-command-done",a)}function cM(b,a,c){this.clear(),this.keyBuffer=[b||""],this.insertModeChanges=[],this.searchQueries=[],this.linewise=!!a,this.blockwise=!!c}function a1(b,a){var c=cl.registerController.registers;if(!b||b.length!=1){throw Error("Register name must be 1 character")}c[b]=a,bH.push(b)}function cZ(a){this.registers=a,this.unnamedRegister=a['"']=new cM,a["."]=new cM,a[":"]=new cM,a["/"]=new cM}function bx(){this.historyBuffer=[],this.iterator=0,this.initialPrefix=null}function bl(b,a){bp[b]=a}function aq(c,a){var d=[];for(var b=0;b<a;b++){d.push(c)}return d}function aQ(b,a){cQ[b]=a}function b7(b,a){cU[b]=a}function ah(f,b,g){var d=Math.min(Math.max(f.firstLine(),b.line),f.lastLine()),a=aA(f,d)-1;a=g?a+1:a;var c=Math.min(Math.max(0,b.ch),a);return cE(d,c)}function ak(b){var a={};for(var c in b){b.hasOwnProperty(c)&&(a[c]=b[c])}return a}function c3(b,a,c){return typeof a=="object"&&(c=a.ch,a=a.line),cE(b.line+a,b.ch+c)}function c4(b,a){return{line:a.line-b.line,ch:a.line-b.line}}function cT(g,k,d,b){var f,l=[],c=[];for(var j=0;j<k.length;j++){var h=k[j];if(d=="insert"&&h.context!="insert"||h.context&&h.context!=d||b.operator&&h.type=="action"||!(f=aT(g,h.keys))){continue}f=="partial"&&l.push(h),f=="full"&&c.push(h)}return{partial:l.length&&l,full:c.length&&c}}function aT(d,b){if(b.slice(-11)=="<character>"){var f=b.length-11,c=d.slice(0,f),a=b.slice(0,f);return c==a&&d.length>f?"full":a.indexOf(c)==0?"partial":!1}return d==b?"full":b.indexOf(d)==0?"partial":!1}function aF(b){var a=/^.*(<[^>]+>)$/.exec(b),c=a?a[1]:b.slice(-1);if(c.length>1){switch(c){case"<CR>":c="\n";break;case"<Space>":c=" ";break;default:c=""}}return c}function ad(b,a,c){return function(){for(var d=0;d<c;d++){a(b)}}}function bf(a){return cE(a.line,a.ch)}function a0(b,a){return b.ch==a.ch&&b.line==a.line}function aK(b,a){return b.line<a.line?!0:b.line==a.line&&b.ch<a.ch?!0:!1}function a5(b,a){return arguments.length>2&&(a=a5.apply(undefined,Array.prototype.slice.call(arguments,1))),aK(b,a)?b:a}function aa(b,a){return arguments.length>2&&(a=aa.apply(undefined,Array.prototype.slice.call(arguments,1))),aK(b,a)?a:b}function aw(d,b,f){var c=aK(d,b),a=aK(b,f);return c&&a}function aA(b,a){return b.getLine(a).length}function cP(a){return a.trim?a.trim():a.replace(/^\s+|\s+$/g,"")}function aP(a){return a.replace(/([.?*+$\[\]\/\\(){}|\-])/g,"\\$1")}function al(d,b,f){var c=aA(d,b),a=(new Array(f-c+1)).join(" ");d.setCursor(cE(b,c)),d.replaceRange(a,d.getCursor())}function ac(J,w){var C=[],z=J.listSelections(),F=bf(J.clipPos(w)),x=!a0(w,F),B=J.getCursor("head"),q=bg(z,B),N=a0(z[q].head,z[q].anchor),I=z.length-1,E=I-q>q?I:0,L=z[E].anchor,G=Math.min(L.line,F.line),A=Math.max(L.line,F.line),K=L.ch,k=F.ch,D=z[E].head.ch-K,H=k-K;D>0&&H<=0?(K++,x||k--):D<0&&H>=0?(K--,N||k++):D<0&&H==-1&&(K--,k++);for(var j=G;j<=A;j++){var M={anchor:new cE(j,K),head:new cE(j,k)};C.push(M)}return J.setSelections(C),w.ch=k,L.ch=K,L}function cj(f,b,g){var d=[];for(var a=0;a<g;a++){var c=c3(b,a,0);d.push({anchor:c,head:c})}f.setSelections(d,0)}function bg(f,b,g){for(var d=0;d<f.length;d++){var a=g!="head"&&a0(f[d].anchor,b),c=g!="anchor"&&a0(f[d].head,b);if(a||c){return d}}return -1}function ag(d,b){var f=b.lastSelection,c=function(){var g=d.listSelections(),k=g[0],j=g[g.length-1],e=aK(k.anchor,k.head)?k.anchor:k.head,h=aK(j.anchor,j.head)?j.head:j.anchor;return[e,h]},a=function(){var B=d.getCursor(),e=d.getCursor(),m=f.visualBlock;if(m){var C=m.width,j=m.height;e=cE(B.line+j,B.ch+C);var A=[];for(var y=B.line;y<e.line;y++){var q=cE(y,B.ch),k=cE(y,e.ch),x={anchor:q,head:k};A.push(x)}d.setSelections(A)}else{var n=f.anchorMark.find(),g=f.headMark.find(),w=g.line-n.line,z=g.ch-n.ch;e={line:e.line+w,ch:w?e.ch:z+e.ch},f.visualLine&&(B=cE(B.line,0),e=cE(e.line,aA(d,e.line))),d.setSelection(B,e)}return[B,e]};return b.visualMode?c():a()}function cD(c,a){var d=a.sel.anchor,b=a.sel.head;a.lastPastedText&&(b=c.posFromIndex(c.indexFromPos(d)+a.lastPastedText.length),a.lastPastedText=null),a.lastSelection={anchorMark:c.setBookmark(d),headMark:c.setBookmark(b),anchor:bf(d),head:bf(b),visualMode:a.visualMode,visualLine:a.visualLine,visualBlock:a.visualBlock}}function cG(f,b,h){var d=f.state.vim.sel,a=d.head,c=d.anchor,g;return aK(h,b)&&(g=h,h=b,b=g),aK(a,c)?(a=a5(b,a),c=aa(c,h)):(c=a5(b,c),a=aa(a,h),a=c3(a,0,-1),a.ch==-1&&a.line!=f.firstLine()&&(a=cE(a.line-1,aA(f,a.line-1)))),[c,a]}function bs(d,b,f){var c=d.state.vim;b=b||c.sel;var f=f||c.visualLine?"line":c.visualBlock?"block":"char",a=bj(d,b,f);d.setSelections(a.ranges,a.primary),bb(d)}function bj(A,G,k,b){var x=bf(G.head),H=bf(G.anchor);if(k=="char"){var j=!b&&!aK(G.head,G.anchor)?1:0,F=aK(G.head,G.anchor)?1:0;return x=c3(G.head,0,j),H=c3(G.anchor,0,F),{ranges:[{anchor:H,head:x}],primary:0}}if(k=="line"){if(!aK(G.head,G.anchor)){H.ch=0;var D=A.lastLine();x.line>D&&(x.line=D),x.ch=aA(A,x.line)}else{x.ch=0,H.ch=aA(A,H.line)}return{ranges:[{anchor:H,head:x}],primary:0}}if(k=="block"){var z=Math.min(H.line,x.line),w=Math.min(H.ch,x.ch),C=Math.max(H.line,x.line),y=Math.max(H.ch,x.ch)+1,g=C-z+1,B=x.line==z?0:g-1,E=[];for(var q=0;q<g;q++){E.push({anchor:cE(z+q,w),head:cE(z+q,y)})}return{ranges:E,primary:B}}}function bZ(b){var a=b.getCursor("head");return b.getSelection().length==1&&(a=a5(a,b.getCursor("anchor"))),a}function cg(b,a){var c=b.state.vim;a!==!1&&b.setCursor(ah(b,c.sel.head)),cD(b,c),c.visualMode=!1,c.visualLine=!1,c.visualBlock=!1,bB.signal(b,"vim-mode-change",{mode:"normal"}),c.fakeCursor&&c.fakeCursor.clear()}function bJ(f,b,g){var d=f.getRange(b,g);if(/\n\s*$/.test(d)){var a=d.split("\n");a.pop();var c;for(var c=a.pop();a.length>0&&c&&cb(c);c=a.pop()){g.line--,g.ch=0}c?(g.line--,g.ch=aA(f,g.line)):g.ch=0}}function bo(b,a,c){a.ch=0,c.ch=0,c.line++}function ap(b){if(!b){return 0}var a=b.search(/\S/);return a==-1?b.length:a}function cY(q,y,g,b,k){var z=bZ(q),d=q.getLine(z.line),x=z.ch,w=k?cF[0]:ck[0];while(!w(d.charAt(x))){x++;if(x>=d.length){return null}}b?w=ck[0]:(w=cF[0],w(d.charAt(x))||(w=cF[1]));var p=x,j=x;while(w(d.charAt(p))&&p<d.length){p++}while(w(d.charAt(j))&&j>=0){j--}j++;if(y){var v=p;while(/\s/.test(d.charAt(p))&&p<d.length){p++}if(v==p){var m=j;while(/\s/.test(d.charAt(j-1))&&j>0){j--}j||(j=m)}}return{start:cE(z.line,j),end:cE(z.line,p)}}function ba(b,a,c){a0(a,c)||cl.jumpList.add(b,a,c)}function aY(b,a){cl.lastCharacterSearch.increment=b,cl.lastCharacterSearch.forward=a.forward,cl.lastCharacterSearch.selectedCharacter=a.selectedCharacter}function cz(x,C,k,b){var q=bf(x.getCursor()),D=k?1:-1,j=k?x.lineCount():-1,B=q.ch,A=q.line,w=x.getLine(A),m={lineText:w,nextCh:w.charAt(B),lastCh:null,index:B,symb:b,reverseSymb:(k?{")":"(","}":"{"}:{"(":")","{":"}"})[b],forward:k,depth:0,curMoveThrough:!1},z=be[b];if(!z){return q}var v=aO[z].init,g=aO[z].isComplete;v&&v(m);while(A!==j&&C){m.index+=D,m.nextCh=m.lineText.charAt(m.index);if(!m.nextCh){A+=D,m.lineText=x.getLine(A)||"";if(D>0){m.index=0}else{var y=m.lineText.length;m.index=y>0?y-1:0}m.nextCh=m.lineText.charAt(m.index)}g(m)&&(q.line=A,q.ch=m.index,C--)}return m.nextCh||m.curMoveThrough?cE(A,m.index):q}function a9(x,C,k,b,q){var D=C.line,j=C.ch,B=x.getLine(D),A=k?1:-1,w=b?ck:cF;if(q&&B==""){D+=A,B=x.getLine(D);if(!ch(x,D)){return null}j=k?0:B.length}for(;;){if(q&&B==""){return{from:0,to:0,line:D}}var m=A>0?B.length:-1,z=m,v=m;while(j!=m){var g=!1;for(var y=0;y<w.length&&!g;++y){if(w[y](B.charAt(j))){z=j;while(j!=m&&w[y](B.charAt(j))){j+=A}v=j,g=z!=v;if(z==C.ch&&D==C.line&&v==z+A){continue}return{from:Math.min(z,v+1),to:Math.max(z,v),line:D}}}g||(j+=A)}D+=A;if(!ch(x,D)){return null}B=x.getLine(D),j=A>0?0:B.length}}function aX(x,C,k,b,q,D){var j=bf(C),B=[];(b&&!q||!b&&q)&&k++;var A=!b||!q;for(var w=0;w<k;w++){var m=a9(x,C,b,D,A);if(!m){var z=aA(x,x.lastLine());B.push(b?{line:x.lastLine(),from:z,to:z}:{line:0,from:0,to:0});break}B.push(m),C=cE(m.line,b?m.to-1:m.from)}var v=B.length!=k,g=B[0],y=B.pop();return b&&!q?(!v&&(g.from!=j.ch||g.line!=j.line)&&(y=B.pop()),cE(y.line,y.from)):b&&q?cE(y.line,y.to-1):!b&&q?(!v&&(g.to!=j.ch||g.line!=j.line)&&(y=B.pop()),cE(y.line,y.to)):cE(y.line,y.from)}function bV(g,k,d,b){var f=g.getCursor(),l=f.ch,c;for(var j=0;j<k;j++){var h=g.getLine(f.line);c=a4(l,h,b,d,!0);if(c==-1){return null}l=c}return cE(g.getCursor().line,c)}function aE(b,a){var c=b.getCursor().line;return ah(b,cE(c,a-1))}function cO(c,a,d,b){if(!cV(d,cy)){return}a.marks[d]&&a.marks[d].clear(),a.marks[d]=c.setBookmark(b)}function a4(f,b,g,d,a){var c;return d?(c=b.indexOf(g,f+1),c!=-1&&!a&&(c-=1)):(c=b.lastIndexOf(g,f-1),c!=-1&&!a&&(c+=1)),c}function c2(A,G,k,b,x){function C(a){return !/\S/.test(A.getLine(a))}function y(c,a,d){return d?C(c)!=C(c+a):!C(c)&&C(c+a)}function g(a){b=b>0?1:-1;var c=A.ace.session.getFoldLine(a);c&&a+b>c.start.row&&a+b<c.end.row&&(b=(b>0?c.end.row:c.start.row)-a)}var H=G.line,j=A.firstLine(),F=A.lastLine(),D,z,w=H;if(b){while(j<=w&&w<=F&&k>0){g(w),y(w,b)&&k--,w+=b}return new cE(w,0)}var B=A.state.vim;if(B.visualLine&&y(H,1,!0)){var E=B.sel.anchor;y(E.line,-1,!0)&&(!x||E.line!=H)&&(H+=1)}var q=C(H);for(w=H;w<=F&&k;w++){y(w,1,!0)&&(!x||C(w)!=q)&&k--}z=new cE(w,0),w>F&&!q?q=!0:x=!1;for(w=H;w>j;w--){if(!x||C(w)==q||w==H){if(y(w,-1,!0)){break}}}return D=new cE(w,0),{start:D,end:z}}function bF(m,w,g,b){var j=w,x,d,v={"(":/[()]/,")":/[()]/,"[":/[[\]]/,"]":/[[\]]/,"{":/[{}]/,"}":/[{}]/}[g],q={"(":"(",")":"(","[":"[","]":"[","{":"{","}":"{"}[g],k=m.getLine(j.line).charAt(j.ch),h=k===q?1:0;x=m.scanForBracket(cE(j.line,j.ch+h),-1,null,{bracketRegex:v}),d=m.scanForBracket(cE(j.line,j.ch+h),1,null,{bracketRegex:v});if(!x||!d){return{start:j,end:j}}x=x.pos,d=d.pos;if(x.line==d.line&&x.ch>d.ch||x.line>d.line){var p=x;x=d,d=p}return b?d.ch+=1:x.ch+=1,{start:x,end:d}}function aJ(m,w,g,b){var j=bf(w),x=m.getLine(j.line),d=x.split(""),v,q,k,h,p=d.indexOf(g);j.ch<p?j.ch=p:p<j.ch&&d[j.ch]==g&&(q=j.ch,--j.ch);if(d[j.ch]==g&&!q){v=j.ch+1}else{for(k=j.ch;k>-1&&!v;k--){d[k]==g&&(v=k+1)}}if(v&&!q){for(k=v,h=d.length;k<h&&!q;k++){d[k]==g&&(q=k)}}return !v||!q?{start:j,end:j}:(b&&(--v,++q),{start:cE(j.line,v),end:cE(j.line,q)})}function br(){}function bm(b){var a=b.state.vim;return a.searchState_||(a.searchState_=new br)}function av(d,b,f,c,a){d.openDialog?d.openDialog(b,c,{bottom:!0,value:a.value,onKeyDown:a.onKeyDown,onKeyUp:a.onKeyUp,selectValueOnOpen:!1,onClose:function(){d.state.vim.status="",d.ace.renderer.$loop.schedule(d.ace.renderer.CHANGE_CURSOR)}}):c(prompt(f,""))}function cS(a){return cX(a,"/")}function aS(a){return ce(a,"/")}function cX(d,b){var f=ce(d,b)||[];if(!f.length){return[]}var c=[];if(f[0]!==0){return}for(var a=0;a<f.length;a++){typeof f[a]=="number"&&c.push(d.substring(f[a]+1,f[a+1]))}return c}function ce(f,b){b||(b="/");var g=!1,d=[];for(var a=0;a<f.length;a++){var c=f.charAt(a);!g&&c==b&&d.push(a),g=!g&&c=="\\"}return d}function aj(g){var k="|(){",d="}",b=!1,f=[];for(var l=-1;l<g.length;l++){var c=g.charAt(l)||"",j=g.charAt(l+1)||"",h=j&&k.indexOf(j)!=-1;b?((c!=="\\"||!h)&&f.push(c),b=!1):c==="\\"?(b=!0,j&&d.indexOf(j)!=-1&&(h=!0),(!h||j==="\\")&&f.push(c)):(f.push(c),h&&j!=="\\"&&f.push("\\"))}return f.join("")}function c5(f){var b=!1,g=[];for(var d=-1;d<f.length;d++){var a=f.charAt(d)||"",c=f.charAt(d+1)||"";am[a+c]?(g.push(am[a+c]),d++):b?(g.push(a),b=!1):a==="\\"?(b=!0,ca(c)||c==="$"?g.push("$"):c!=="/"&&c!=="\\"&&g.push("\\")):(a==="$"&&g.push("$"),g.push(a),c==="/"&&g.push("\\"))}return g.join("")}function cW(d){var b=new bB.StringStream(d),f=[];while(!b.eol()){while(b.peek()&&b.peek()!="\\"){f.push(b.next())}var c=!1;for(var a in c6){if(b.match(a,!0)){c=!0,f.push(c6[a]);break}}c||f.push(b.next())}return f.join("")}function aW(g,k,d){var b=cl.registerController.getRegister("/");b.setText(g);if(g instanceof RegExp){return g}var f=aS(g),l,c;if(!f.length){l=g}else{l=g.substring(0,f[0]);var j=g.substring(f[0]);c=j.indexOf("i")!=-1}if(!l){return null}cB("pcre")||(l=aj(l)),d&&(k=/^[^A-Z]*$/.test(l));var h=new RegExp(l,k||c?"i":undefined);return h}function aI(b,a){b.openNotification?b.openNotification('<span style="color: red">'+a+"</span>",{bottom:!0,duration:5000}):alert(a)}function af(b,a){var c='<span style="font-family: monospace; white-space: pre">'+(b||"")+'<input type="text"></span>';return a&&(c+=' <span style="color: #888">'+a+"</span>"),c}function a3(c,a){var d=(a.prefix||"")+" "+(a.desc||""),b=af(a.prefix,a.desc);av(c,b,d,a.onClose,a)}function aN(d,b){if(d instanceof RegExp&&b instanceof RegExp){var f=["global","multiline","ignoreCase","source"];for(var c=0;c<f.length;c++){var a=f[c];if(d[a]!==b[a]){return !1}}return !0}return !1}function a8(f,b,g,d){if(!b){return}var a=bm(f),c=aW(b,!!g,!!d);if(!c){return}return az(f,c),aN(c,a.getQuery())?c:(a.setQuery(c),c)}function ab(b){if(b.source.charAt(0)=="^"){var a=!0}return{token:function(d){if(a&&!d.sol()){d.skipToEnd();return}var c=d.match(b,!1);if(c){if(c[0].length==0){return d.next(),"searching"}if(!d.sol()){d.backUp(1);if(!b.exec(d.next()+c[0])){return d.next(),null}}return d.match(b),"searching"}while(!d.eol()){d.next();if(d.match(b,!1)){break}}},query:b}}function az(c,a){var d=bm(c),b=d.getOverlay();if(!b||a!=b.query){b&&c.removeOverlay(b),b=ab(a),c.addOverlay(b),c.showMatchesOnScrollbar&&(d.getScrollbarAnnotate()&&d.getScrollbarAnnotate().clear(),d.setScrollbarAnnotate(c.showMatchesOnScrollbar(a))),d.setOverlay(b)}}function aD(c,a,d,b){return b===undefined&&(b=1),c.operation(function(){var f=c.getCursor(),g=c.getSearchCursor(d,f);for(var h=0;h<b;h++){var e=g.find(a);h==0&&e&&a0(g.from(),f)&&(e=g.find(a));if(!e){g=c.getSearchCursor(d,a?cE(c.lastLine()):cE(c.firstLine(),0));if(!g.find(a)){return}}}return g.from()})}function cR(b){var a=bm(b);b.removeOverlay(bm(b).getOverlay()),a.setOverlay(null),a.getScrollbarAnnotate()&&(a.getScrollbarAnnotate().clear(),a.setScrollbarAnnotate(null))}function aR(b,a,c){return typeof b!="number"&&(b=b.line),a instanceof Array?cV(b,a):c?b>=a&&b<=c:b==a}function ao(b){var a=b.ace.renderer;return{top:a.getFirstFullyVisibleRow(),bottom:a.getLastFullyVisibleRow()}}function ae(c,a,d){var b=a.marks[d];return b&&b.find()}function cK(z,E,k,b,w,F,j,D,C){function B(){z.operation(function(){while(!y){x(),g()}A()})}function x(){var a=z.getRange(F.from(),F.to()),c=a.replace(j,D);F.replace(c)}function g(){while(F.findNext()&&aR(F.from(),b,w)){if(!k&&v&&F.from().line==v.line){continue}z.scrollIntoView(F.from(),30),z.setSelection(F.from(),F.to()),v=F.from(),y=!1;return}y=!0}function A(a){a&&a(),z.focus();if(v){z.setCursor(v);var c=z.state.vim;c.exMode=!1,c.lastHPos=c.lastHSPos=v.ch}C&&C()}function q(c,f,e){bB.e_stop(c);var a=bB.keyName(c);switch(a){case"Y":x(),g();break;case"N":g();break;case"A":var d=C;C=undefined,z.operation(B),C=d;break;case"L":x();case"Q":case"Esc":case"Ctrl-C":case"Ctrl-[":A(e)}return y&&A(e),!0}z.state.vim.exMode=!0;var y=!1,v=F.from();g();if(y){aI(z,"No matches for "+j.source);return}if(!E){B(),C&&C();return}a3(z,{prefix:"replace with <strong>"+D+"</strong> (y/n/a/q/l)",onKeyDown:q})}function cL(j){var m=j.state.vim,d=cl.macroModeState,b=cl.registerController.getRegister("."),g=d.isPlaying,p=d.lastInsertModeChanges,c=[];if(!g){var l=p.inVisualBlock&&m.lastSelection?m.lastSelection.visualBlock.height:1,k=p.changes,c=[],h=0;while(h<k.length){c.push(k[h]),k[h] instanceof bd?h++:h+=l}p.changes=c,j.off("change",au),bB.off(j.getInputField(),"keydown",aM)}!g&&m.insertModeRepeat>1&&(cs(j,m,m.insertModeRepeat-1,!0),m.lastEditInputState.repeatOverride=m.insertModeRepeat),delete m.insertModeRepeat,m.insertMode=!1,j.setCursor(j.getCursor().line,j.getCursor().ch-1),j.setOption("keyMap","vim"),j.setOption("disableInput",!0),j.toggleOverwrite(!1),b.setText(p.changes.join("")),bB.signal(j,"vim-mode-change",{mode:"normal"}),d.isRecording&&bS(d)}function bu(a){b2.unshift(a)}function bk(f,b,h,d,a){var c={keys:f,type:b};c[b]=h,c[b+"Args"]=d;for(var g in a){c[g]=a[g]}bu(c)}function b5(m,w,g,b){var j=cl.registerController.getRegister(b);if(b==":"){j.keyBuffer[0]&&ai.processCommand(m,j.keyBuffer[0]),g.isPlaying=!1;return}var x=j.keyBuffer,d=0;g.isPlaying=!0,g.replaySearchQueries=j.searchQueries.slice(0);for(var v=0;v<x.length;v++){var q=x[v],k,h;while(q){k=/<\w+-.+?>|<\w+>|./.exec(q),h=k[0],q=q.substring(k.index+h.length),bB.Vim.handleKey(m,h,"macro");if(w.insertMode){var p=j.insertModeChanges[d++].changes;cl.macroModeState.lastInsertModeChanges.changes=p,a7(m,p,1),cL(m)}}}g.isPlaying=!1}function cq(c,a){if(c.isPlaying){return}var d=c.latestRegister,b=cl.registerController.getRegister(d);b&&b.pushText(a)}function bS(b){if(b.isPlaying){return}var a=b.latestRegister,c=cl.registerController.getRegister(a);c&&c.pushInsertModeChanges&&c.pushInsertModeChanges(b.lastInsertModeChanges)}function bq(c,a){if(c.isPlaying){return}var d=c.latestRegister,b=cl.registerController.getRegister(d);b&&b.pushSearchQuery&&b.pushSearchQuery(a)}function au(d,b){var f=cl.macroModeState,c=f.lastInsertModeChanges;if(!f.isPlaying){while(b){c.expectCursorActivityForChange=!0;if(b.origin=="+input"||b.origin=="paste"||b.origin===undefined){var a=b.text.join("\n");c.maybeReset&&(c.changes=[],c.maybeReset=!1),d.state.overwrite&&!/\n/.test(a)?c.changes.push([a]):c.changes.push(a)}b=b.next}}}function c1(c){var a=c.state.vim;if(a.insertMode){var d=cl.macroModeState;if(d.isPlaying){return}var b=d.lastInsertModeChanges;b.expectCursorActivityForChange?b.expectCursorActivityForChange=!1:b.maybeReset=!0}else{c.curOp.isVimOp||aZ(c,a)}a.visualMode&&bb(c)}function bb(c){var a=c.state.vim,d=ah(c,bf(a.sel.head)),b=c3(d,0,1);a.fakeCursor&&a.fakeCursor.clear(),a.fakeCursor=c.markText(d,b,{className:"cm-animate-fat-cursor"})}function aZ(f,b){var g=f.getCursor("anchor"),d=f.getCursor("head");b.visualMode&&!f.somethingSelected()?cg(f,!1):!b.visualMode&&!b.insertMode&&f.somethingSelected()&&(b.visualMode=!0,b.visualLine=!1,bB.signal(f,"vim-mode-change",{mode:"visual"}));if(b.visualMode){var a=aK(d,g)?0:-1,c=aK(d,g)?-1:0;d=c3(d,0,a),g=c3(g,0,c),b.sel={anchor:g,head:d},cO(f,b,"<",a5(d,g)),cO(f,b,">",aa(d,g))}else{b.insertMode||(b.lastHPos=f.getCursor().ch)}}function bd(a){this.keyName=a}function aM(d){function b(){return f.maybeReset&&(f.changes=[],f.maybeReset=!1),f.changes.push(new bd(c)),!0}var a=cl.macroModeState,f=a.lastInsertModeChanges,c=bB.keyName(d);if(!c){return}(c.indexOf("Delete")!=-1||c.indexOf("Backspace")!=-1)&&bB.lookupKey(c,"vim-insert",b)}function cs(j,m,d,b){function l(){p?aG.processAction(j,m,m.lastEditActionCommand):aG.evalInput(j,m)}function k(e){if(g.lastInsertModeChanges.changes.length>0){e=m.lastEditActionCommand?e:1;var a=g.lastInsertModeChanges;a7(j,a.changes,e)}}var g=cl.macroModeState;g.isPlaying=!0;var p=!!m.lastEditActionCommand,c=m.inputState;m.inputState=m.lastEditInputState;if(p&&m.lastEditActionCommand.interlaceInsertRepeat){for(var h=0;h<d;h++){l(),k(1)}}else{b||l(),k(d)}m.inputState=c,m.insertMode&&!b&&cL(j),g.isPlaying=!1}function a7(x,C,k){function b(a){return typeof a=="string"?bB.commands[a](x):a(x),!0}var q=x.getCursor("head"),D=cl.macroModeState.lastInsertModeChanges.inVisualBlock;if(D){var j=x.state.vim,B=j.lastSelection,A=c4(B.anchor,B.head);cj(x,q,A.line+1),k=x.listSelections().length,x.setCursor(q)}for(var w=0;w<k;w++){D&&x.setCursor(c3(q,w,0));for(var m=0;m<C.length;m++){var z=C[m];if(z instanceof bd){bB.lookupKey(z.keyName,"vim-insert",b)}else{if(typeof z=="string"){var v=x.getCursor();x.replaceRange(z,v,v)}else{var g=x.getCursor(),y=c3(g,0,z[0].length);x.replaceRange(z[0],g,y)}}}}D&&x.setCursor(c3(q,0,1))}function aV(c,a,d){a.length>1&&a[0]=="n"&&(a=a.replace("numpad","")),a=ay[a]||a;var b="";return d.ctrlKey&&(b+="C-"),d.altKey&&(b+="A-"),d.shiftKey&&(b+="S-"),b+=a,b.length>1&&(b="<"+b+">"),b}function aC(b){var a=new b.constructor;return Object.keys(b).forEach(function(d){var c=b[d];Array.isArray(c)?c=c.slice():c&&typeof c=="object"&&c.constructor!=Object&&(c=aC(c)),a[d]=c}),b.sel&&(a.sel={head:b.sel.head&&bf(b.sel.head),anchor:b.sel.anchor&&bf(b.sel.anchor)}),a}function cN(f,b,h){var d=!1,a=cf.maybeInitVimState_(f),c=a.visualBlock||a.wasInVisualBlock;a.wasInVisualBlock&&!f.ace.inMultiSelectMode?a.wasInVisualBlock=!1:f.ace.inMultiSelectMode&&a.visualBlock&&(a.wasInVisualBlock=!0);if(b=="<Esc>"&&!a.insertMode&&!a.visualMode&&f.ace.inMultiSelectMode){f.ace.exitMultiSelectMode()}else{if(c||!f.ace.inMultiSelectMode||f.ace.inVirtualSelectionMode){d=cf.handleKey(f,b,h)}else{var g=aC(a);f.operation(function(){f.ace.forEachSelection(function(){var k=f.ace.selection;f.state.vim.lastHPos=k.$desiredColumn==null?k.lead.column:k.$desiredColumn;var l=f.getCursor("head"),j=f.getCursor("anchor"),e=aK(l,j)?0:-1,m=aK(l,j)?-1:0;l=c3(l,0,e),j=c3(j,0,m),f.state.vim.sel.head=l,f.state.vim.sel.anchor=j,d=bO(f,b,h),k.$desiredColumn=f.state.vim.lastHPos==-1?null:f.state.vim.lastHPos,f.virtualSelectionMode()&&(f.state.vim=aC(g))}),f.curOp.cursorActivity&&!d&&(f.curOp.cursorActivity=!1)},!0)}}return d}function bA(b,a){a.off("beforeEndOperation",bA);var c=a.state.cm.vimCmd;c&&a.execCommand(c.exec?c:c.name,c.args),a.curOp=a.prevOp}var bT=bY("../range").Range,bE=bY("../lib/event_emitter").EventEmitter,bK=bY("../lib/dom"),bC=bY("../lib/oop"),b3=bY("../lib/keys"),bX=bY("../lib/event"),bP=bY("../search").Search,b1=bY("../lib/useragent"),bU=bY("../search_highlight").SearchHighlight,bI=bY("../commands/multi_select_commands"),b0=bY("../mode/text").Mode.prototype.tokenRe;bY("../multi_select");var bB=function(a){this.ace=a,this.state={},this.marks={},this.$uid=0,this.onChange=this.onChange.bind(this),this.onSelectionChange=this.onSelectionChange.bind(this),this.onBeforeEndOperation=this.onBeforeEndOperation.bind(this),this.ace.on("change",this.onChange),this.ace.on("changeSelection",this.onSelectionChange),this.ace.on("beforeEndOperation",this.onBeforeEndOperation)};bB.Pos=function(b,a){if(!(this instanceof cE)){return new cE(b,a)}this.line=b,this.ch=a},bB.defineOption=function(b,a,c){},bB.commands={redo:function(a){a.ace.redo()},undo:function(a){a.ace.undo()},newlineAndIndent:function(a){a.ace.insert("\n")}},bB.keyMap={},bB.addClass=bB.rmClass=function(){},bB.e_stop=bB.e_preventDefault=bX.stopEvent,bB.keyName=function(b){var a=b3[b.keyCode]||b.key||"";return a.length==1&&(a=a.toUpperCase()),a=bX.getModifierString(b).replace(/(^|-)\w/g,function(c){return c.toUpperCase()})+a,a},bB.keyMap["default"]=function(a){return function(b){var c=b.ace.commands.commandKeyBinding[a.toLowerCase()];return c&&b.ace.execCommand(c)!==!1}},bB.lookupKey=function aH(f,b,g){typeof b=="string"&&(b=bB.keyMap[b]);var d=typeof b=="function"?b(f):b[f];if(d===!1){return"nothing"}if(d==="..."){return"multi"}if(d!=null&&g(d)){return"handled"}if(b.fallthrough){if(!Array.isArray(b.fallthrough)){return aH(f,b.fallthrough,g)}for(var a=0;a<b.fallthrough.length;a++){var c=aH(f,b.fallthrough[a],g);if(c){return c}}}},bB.signal=function(b,a,c){return b._signal(a,c)},bB.on=bX.addListener,bB.off=bX.removeListener,bB.isWordChar=function(a){return a<""?/^\w$/.test(a):(b0.lastIndex=0,b0.test(a))},function(){bC.implement(bB.prototype,bE),this.destroy=function(){this.ace.off("change",this.onChange),this.ace.off("changeSelection",this.onSelectionChange),this.ace.off("beforeEndOperation",this.onBeforeEndOperation),this.removeOverlay()},this.virtualSelectionMode=function(){return this.ace.inVirtualSelectionMode&&this.ace.selection.index},this.onChange=function(d){var c={text:d.action[0]=="i"?d.lines:[]},f=this.curOp=this.curOp||{};f.changeHandlers||(f.changeHandlers=this._eventRegistry.change&&this._eventRegistry.change.slice());if(this.virtualSelectionMode()){return}f.lastChange?f.lastChange.next=f.lastChange=c:f.lastChange=f.change=c,this.$updateMarkers(d)},this.onSelectionChange=function(){var c=this.curOp=this.curOp||{};c.cursorActivityHandlers||(c.cursorActivityHandlers=this._eventRegistry.cursorActivity&&this._eventRegistry.cursorActivity.slice()),this.curOp.cursorActivity=!0,this.ace.inMultiSelectMode&&this.ace.keyBinding.removeKeyboardHandler(bI.keyboardHandler)},this.operation=function(g,d){if(!d&&this.curOp||d&&this.curOp&&this.curOp.force){return g()}(d||!this.ace.curOp)&&this.curOp&&this.onBeforeEndOperation();if(!this.ace.curOp){var h=this.ace.prevOp;this.ace.startOperation({command:{name:"vim",scrollIntoView:"cursor"}})}var f=this.curOp=this.curOp||{};this.curOp.force=d;var c=g();return this.ace.curOp&&this.ace.curOp.command.name=="vim"&&(this.ace.endOperation(),!f.cursorActivity&&!f.lastChange&&h&&(this.ace.prevOp=h)),(d||!this.ace.curOp)&&this.curOp&&this.onBeforeEndOperation(),c},this.onBeforeEndOperation=function(){var c=this.curOp;c&&(c.change&&this.signal("change",c.change,c),c&&c.cursorActivity&&this.signal("cursorActivity",null,c),this.curOp=null)},this.signal=function(g,d,h){var f=h?h[g+"Handlers"]:(this._eventRegistry||{})[g];if(!f){return}f=f.slice();for(var c=0;c<f.length;c++){f[c](this,d)}},this.firstLine=function(){return 0},this.lastLine=function(){return this.ace.session.getLength()-1},this.lineCount=function(){return this.ace.session.getLength()},this.setCursor=function(d,c){typeof d=="object"&&(c=d.ch,d=d.line),this.ace.inVirtualSelectionMode||this.ace.exitMultiSelectMode(),this.ace.session.unfold({row:d,column:c}),this.ace.selection.moveTo(d,c)},this.getCursor=function(d){var c=this.ace.selection,f=d=="anchor"?c.isEmpty()?c.lead:c.anchor:d=="head"||!d?c.lead:c.getRange()[d];return bW(f)},this.listSelections=function(d){var c=this.ace.multiSelect.rangeList.ranges;return !c.length||this.ace.inVirtualSelectionMode?[{anchor:this.getCursor("anchor"),head:this.getCursor("head")}]:c.map(function(f){return{anchor:this.clipPos(bW(f.cursor==f.end?f.start:f.end)),head:this.clipPos(bW(f.cursor))}},this)},this.setSelections=function(h,d){var j=this.ace.multiSelect,g=h.map(function(m){var k=bN(m.anchor),o=bN(m.head),l=bT.comparePoints(k,o)<0?new bT.fromPoints(k,o):new bT.fromPoints(o,k);return l.cursor=bT.comparePoints(l.start,o)?l.end:l.start,l});if(this.ace.inVirtualSelectionMode){this.ace.selection.fromOrientedRange(g[0]);return}d?g[d]&&g.push(g.splice(d,1)[0]):g=g.reverse(),j.toSingleRange(g[0].clone());var f=this.ace.session;for(var i=0;i<g.length;i++){var c=f.$clipRangeToDocument(g[i]);j.addRange(c)}},this.setSelection=function(f,c,g){var d=this.ace.selection;d.moveTo(f.line,f.ch),d.selectTo(c.line,c.ch),g&&g.origin=="*mouse"&&this.onBeforeEndOperation()},this.somethingSelected=function(c){return !this.ace.selection.isEmpty()},this.clipPos=function(d){var c=this.ace.session.$clipPositionToDocument(d.line,d.ch);return bW(c)},this.markText=function(c){return{clear:function(){},find:function(){}}},this.$updateMarkers=function(j){var p=j.action=="insert",g=j.start,c=j.end,q=(c.row-g.row)*(p?1:-1),d=(c.column-g.column)*(p?1:-1);p&&(c=g);for(var m in this.marks){var k=this.marks[m],i=bT.comparePoints(k,g);if(i<0){continue}if(i===0&&p){if(k.bias!=1){k.bias=-1;continue}i=1}var h=p?i:bT.comparePoints(k,c);if(h>0){k.row+=q,k.column+=k.row==c.row?d:0;continue}!p&&h<=0&&(k.row=g.row,k.column=g.column,h===0&&(k.bias=1))}};var b=function(f,c,g,d){this.cm=f,this.id=c,this.row=g,this.column=d,f.marks[this.id]=this};b.prototype.clear=function(){delete this.cm.marks[this.id]},b.prototype.find=function(){return bW(this)},this.setBookmark=function(c,e){var d=new b(this,this.$uid++,c.line,c.ch);if(!e||!e.insertLeft){d.$insertRight=!0}return this.marks[d.id]=d,d},this.moveH=function(d,c){if(c=="char"){var f=this.ace.selection;f.clearSelection(),f.moveCursorBy(0,d)}},this.findPosV=function(j,f,l,h){if(l=="page"){var d=this.ace.renderer,g=d.layerConfig;f*=Math.floor(g.height/g.lineHeight),l="line"}if(l=="line"){var k=this.ace.session.documentToScreenPosition(j.line,j.ch);h!=null&&(k.column=h),k.row+=f,k.row=Math.min(Math.max(0,k.row),this.ace.session.getScreenLength()-1);var c=this.ace.session.screenToDocumentPosition(k.row,k.column);return bW(c)}},this.charCoords=function(h,d){if(d=="div"||!d){var k=this.ace.session.documentToScreenPosition(h.line,h.ch);return{left:k.column,top:k.row}}if(d=="local"){var g=this.ace.renderer,k=this.ace.session.documentToScreenPosition(h.line,h.ch),c=g.layerConfig.lineHeight,f=g.layerConfig.characterWidth,j=c*k.row;return{left:k.column*f,top:j,bottom:j+c}}},this.coordsChar=function(h,d){var j=this.ace.renderer;if(d=="local"){var g=Math.max(0,Math.floor(h.top/j.lineHeight)),c=Math.max(0,Math.floor(h.left/j.characterWidth)),f=j.session.screenToDocumentPosition(g,c);return bW(f)}if(d=="div"){throw"not implemented"}},this.getSearchCursor=function(h,l,f){var c=!1,g=!1;h instanceof RegExp&&!h.global&&(c=!h.ignoreCase,h=h.source,g=!0);var m=new bP;l.ch==undefined&&(l.ch=Number.MAX_VALUE);var d={row:l.line,column:l.ch},k=this,j=null;return{findNext:function(){return this.find(!1)},findPrevious:function(){return this.find(!0)},find:function(e){m.setOptions({needle:h,caseSensitive:c,wrap:!1,backwards:e,regExp:g,start:j||d});var i=m.find(k.ace.session);return i&&i.isEmpty()&&k.getLine(i.start.row).length==i.start.column&&(m.$options.start=i,i=m.find(k.ace.session)),j=i,j},from:function(){return j&&bW(j.start)},to:function(){return j&&bW(j.end)},replace:function(i){j&&(j.end=k.ace.session.doc.replace(j,i))}}},this.scrollTo=function(g,d){var h=this.ace.renderer,f=h.layerConfig,c=f.maxHeight;c-=(h.$size.scrollerHeight-h.lineHeight)*h.$scrollPastEnd,d!=null&&this.ace.session.setScrollTop(Math.max(0,Math.min(d,c))),g!=null&&this.ace.session.setScrollLeft(Math.max(0,Math.min(g,f.width)))},this.scrollInfo=function(){return 0},this.scrollIntoView=function(f,c){if(f){var g=this.ace.renderer,d={top:0,bottom:c};g.scrollCursorIntoView(bN(f),g.lineHeight*2/g.$size.scrollerHeight,d)}},this.getLine=function(c){return this.ace.session.getLine(c)},this.getRange=function(d,c){return this.ace.session.getTextRange(new bT(d.line,d.ch,c.line,c.ch))},this.replaceRange=function(d,c,f){return f||(f=c),this.ace.session.replace(new bT(c.line,c.ch,f.line,f.ch),d)},this.replaceSelections=function(f){var c=this.ace.selection;if(this.ace.inVirtualSelectionMode){this.ace.session.replace(c.getRange(),f[0]||"");return}c.inVirtualSelectionMode=!0;var g=c.rangeList.ranges;g.length||(g=[this.ace.multiSelect.getRange()]);for(var d=g.length;d--;){this.ace.session.replace(g[d],f[d]||"")}c.inVirtualSelectionMode=!1},this.getSelection=function(){return this.ace.getSelectedText()},this.getSelections=function(){return this.listSelections().map(function(c){return this.getRange(c.anchor,c.head)},this)},this.getInputField=function(){return this.ace.textInput.getElement()},this.getWrapperElement=function(){return this.ace.containter};var a={indentWithTabs:"useSoftTabs",indentUnit:"tabSize",tabSize:"tabSize",firstLineNumber:"firstLineNumber",readOnly:"readOnly"};this.setOption=function(c,d){this.state[c]=d;switch(c){case"indentWithTabs":c=a[c],d=!d;break;default:c=a[c]}c&&this.ace.setOption(c,d)},this.getOption=function(d,f){var c=a[d];c&&(f=this.ace.getOption(c));switch(d){case"indentWithTabs":return d=a[d],!f}return c?f:this.state[d]},this.toggleOverwrite=function(c){return this.state.overwrite=c,this.ace.setOverwrite(c)},this.addOverlay=function(f){if(!this.$searchHighlight||!this.$searchHighlight.session){var c=new bU(null,"ace_highlight-marker","text"),g=this.ace.session.addDynamicMarker(c);c.id=g.id,c.session=this.ace.session,c.destroy=function(h){c.session.off("change",c.updateOnChange),c.session.off("changeEditor",c.destroy),c.session.removeMarker(c.id),c.session=null},c.updateOnChange=function(h){var i=h.start.row;i==h.end.row?c.cache[i]=undefined:c.cache.splice(i,c.cache.length)},c.session.on("changeEditor",c.destroy),c.session.on("change",c.updateOnChange)}var d=new RegExp(f.query.source,"gmi");this.$searchHighlight=f.highlight=c,this.$searchHighlight.setRegexp(d),this.ace.renderer.updateBackMarkers()},this.removeOverlay=function(c){this.$searchHighlight&&this.$searchHighlight.session&&this.$searchHighlight.destroy()},this.getScrollInfo=function(){var d=this.ace.renderer,c=d.layerConfig;return{left:d.scrollLeft,top:d.scrollTop,height:c.maxHeight,width:c.width,clientHeight:c.height,clientWidth:c.width}},this.getValue=function(){return this.ace.getValue()},this.setValue=function(c){return this.ace.setValue(c)},this.getTokenTypeAt=function(d){var c=this.ace.session.getTokenAt(d.line,d.ch);return c&&/comment|string/.test(c.type)?"string":""},this.findMatchingBracket=function(d){var c=this.ace.session.findMatchingBracket(bN(d));return{to:c&&bW(c)}},this.indentLine=function(d,c){c===!0?this.ace.session.indentRows(d,d,"	"):c===!1&&this.ace.session.outdentRows(new bT(d,0,d,0))},this.indexFromPos=function(c){return this.ace.session.doc.positionToIndex(bN(c))},this.posFromIndex=function(c){return bW(this.ace.session.doc.indexToPosition(c))},this.focus=function(c){return this.ace.textInput.focus()},this.blur=function(c){return this.ace.blur()},this.defaultTextHeight=function(c){return this.ace.renderer.layerConfig.lineHeight},this.scanForBracket=function(h,d,j,g){var c=g.bracketRegex.source;if(d==1){var f=this.ace.session.$findClosingBracket(c.slice(1,2),bN(h),/paren|text/)}else{var f=this.ace.session.$findOpeningBracket(c.slice(-2,-1),{row:h.line,column:h.ch+1},/paren|text/)}return f&&{pos:bW(f)}},this.refresh=function(){return this.ace.resize(!0)},this.getMode=function(){return{name:this.getOption("mode")}}}.call(bB.prototype);var bw=bB.StringStream=function(b,a){this.pos=this.start=0,this.string=b,this.tabSize=a||8,this.lastColumnPos=this.lastColumnValue=0,this.lineStart=0};bw.prototype={eol:function(){return this.pos>=this.string.length},sol:function(){return this.pos==this.lineStart},peek:function(){return this.string.charAt(this.pos)||undefined},next:function(){if(this.pos<this.string.length){return this.string.charAt(this.pos++)}},eat:function(b){var a=this.string.charAt(this.pos);if(typeof b=="string"){var c=a==b}else{var c=a&&(b.test?b.test(a):b(a))}if(c){return ++this.pos,a}},eatWhile:function(b){var a=this.pos;while(this.eat(b)){}return this.pos>a},eatSpace:function(){var a=this.pos;while(/[\s\u00a0]/.test(this.string.charAt(this.pos))){++this.pos}return this.pos>a},skipToEnd:function(){this.pos=this.string.length},skipTo:function(b){var a=this.string.indexOf(b,this.pos);if(a>-1){return this.pos=a,!0}},backUp:function(a){this.pos-=a},column:function(){throw"not implemented"},indentation:function(){throw"not implemented"},match:function(f,b,g){if(typeof f!="string"){var c=this.string.slice(this.pos).match(f);return c&&c.index>0?null:(c&&b!==!1&&(this.pos+=c[0].length),c)}var d=function(h){return g?h.toLowerCase():h},a=this.string.substr(this.pos,f.length);if(d(a)==d(f)){return b!==!1&&(this.pos+=f.length),!0}},current:function(){return this.string.slice(this.start,this.pos)},hideFirstChars:function(b,a){this.lineStart+=b;try{return a()}finally{this.lineStart-=b}}},bB.defineExtension=function(b,a){bB.prototype[b]=a},bK.importCssString(".normal-mode .ace_cursor{  border: 1px solid red;  background-color: red;  opacity: 0.5;}.normal-mode .ace_hidden-cursors .ace_cursor{  background-color: transparent;}.ace_dialog {  position: absolute;  left: 0; right: 0;  background: white;  z-index: 15;  padding: .1em .8em;  overflow: hidden;  color: #333;}.ace_dialog-top {  border-bottom: 1px solid #eee;  top: 0;}.ace_dialog-bottom {  border-top: 1px solid #eee;  bottom: 0;}.ace_dialog input {  border: none;  outline: none;  background: transparent;  width: 20em;  color: inherit;  font-family: monospace;}","vimMode"),function(){function b(g,d,h){var f=g.ace.container,c;return c=f.appendChild(document.createElement("div")),h?c.className="ace_dialog ace_dialog-bottom":c.className="ace_dialog ace_dialog-top",typeof d=="string"?c.innerHTML=d:c.appendChild(d),c}function a(d,c){d.state.currentNotificationClose&&d.state.currentNotificationClose(),d.state.currentNotificationClose=c}bB.defineExtension("openDialog",function(e,c,h){function k(f){if(typeof f=="string"){j.value=f}else{if(d){return}d=!0,p.parentNode.removeChild(p),m.focus(),h.onClose&&h.onClose(p)}}if(this.virtualSelectionMode()){return}h||(h={}),a(this,null);var p=b(this,e,h.bottom),d=!1,m=this,j=p.getElementsByTagName("input")[0],g;if(j){h.value&&(j.value=h.value,h.selectValueOnOpen!==!1&&j.select()),h.onInput&&bB.on(j,"input",function(f){h.onInput(f,j.value,k)}),h.onKeyUp&&bB.on(j,"keyup",function(f){h.onKeyUp(f,j.value,k)}),bB.on(j,"keydown",function(f){if(h&&h.onKeyDown&&h.onKeyDown(f,j.value,k)){return}if(f.keyCode==27||h.closeOnEnter!==!1&&f.keyCode==13){j.blur(),bB.e_stop(f),k()}f.keyCode==13&&c(j.value)}),h.closeOnBlur!==!1&&bB.on(j,"blur",k),j.focus()}else{if(g=p.getElementsByTagName("button")[0]){bB.on(g,"click",function(){k(),m.focus()}),h.closeOnBlur!==!1&&bB.on(g,"blur",k),g.focus()}}return k}),bB.defineExtension("openNotification",function(j,g){function c(){if(f){return}f=!0,clearTimeout(h),e.parentNode.removeChild(e)}if(this.virtualSelectionMode()){return}a(this,c);var e=b(this,j,g&&g.bottom),f=!1,h,d=g&&typeof g.duration!="undefined"?g.duration:5000;return bB.on(e,"click",function(i){bB.e_preventDefault(i),c()}),d&&(h=setTimeout(c,d)),c})}();var b2=[{keys:"<Left>",type:"keyToKey",toKeys:"h"},{keys:"<Right>",type:"keyToKey",toKeys:"l"},{keys:"<Up>",type:"keyToKey",toKeys:"k"},{keys:"<Down>",type:"keyToKey",toKeys:"j"},{keys:"<Space>",type:"keyToKey",toKeys:"l"},{keys:"<BS>",type:"keyToKey",toKeys:"h",context:"normal"},{keys:"<C-Space>",type:"keyToKey",toKeys:"W"},{keys:"<C-BS>",type:"keyToKey",toKeys:"B",context:"normal"},{keys:"<S-Space>",type:"keyToKey",toKeys:"w"},{keys:"<S-BS>",type:"keyToKey",toKeys:"b",context:"normal"},{keys:"<C-n>",type:"keyToKey",toKeys:"j"},{keys:"<C-p>",type:"keyToKey",toKeys:"k"},{keys:"<C-[>",type:"keyToKey",toKeys:"<Esc>"},{keys:"<C-c>",type:"keyToKey",toKeys:"<Esc>"},{keys:"<C-[>",type:"keyToKey",toKeys:"<Esc>",context:"insert"},{keys:"<C-c>",type:"keyToKey",toKeys:"<Esc>",context:"insert"},{keys:"s",type:"keyToKey",toKeys:"cl",context:"normal"},{keys:"s",type:"keyToKey",toKeys:"c",context:"visual"},{keys:"S",type:"keyToKey",toKeys:"cc",context:"normal"},{keys:"S",type:"keyToKey",toKeys:"VdO",context:"visual"},{keys:"<Home>",type:"keyToKey",toKeys:"0"},{keys:"<End>",type:"keyToKey",toKeys:"$"},{keys:"<PageUp>",type:"keyToKey",toKeys:"<C-b>"},{keys:"<PageDown>",type:"keyToKey",toKeys:"<C-f>"},{keys:"<CR>",type:"keyToKey",toKeys:"j^",context:"normal"},{keys:"<Ins>",type:"action",action:"toggleOverwrite",context:"insert"},{keys:"H",type:"motion",motion:"moveToTopLine",motionArgs:{linewise:!0,toJumplist:!0}},{keys:"M",type:"motion",motion:"moveToMiddleLine",motionArgs:{linewise:!0,toJumplist:!0}},{keys:"L",type:"motion",motion:"moveToBottomLine",motionArgs:{linewise:!0,toJumplist:!0}},{keys:"h",type:"motion",motion:"moveByCharacters",motionArgs:{forward:!1}},{keys:"l",type:"motion",motion:"moveByCharacters",motionArgs:{forward:!0}},{keys:"j",type:"motion",motion:"moveByLines",motionArgs:{forward:!0,linewise:!0}},{keys:"k",type:"motion",motion:"moveByLines",motionArgs:{forward:!1,linewise:!0}},{keys:"gj",type:"motion",motion:"moveByDisplayLines",motionArgs:{forward:!0}},{keys:"gk",type:"motion",motion:"moveByDisplayLines",motionArgs:{forward:!1}},{keys:"w",type:"motion",motion:"moveByWords",motionArgs:{forward:!0,wordEnd:!1}},{keys:"W",type:"motion",motion:"moveByWords",motionArgs:{forward:!0,wordEnd:!1,bigWord:!0}},{keys:"e",type:"motion",motion:"moveByWords",motionArgs:{forward:!0,wordEnd:!0,inclusive:!0}},{keys:"E",type:"motion",motion:"moveByWords",motionArgs:{forward:!0,wordEnd:!0,bigWord:!0,inclusive:!0}},{keys:"b",type:"motion",motion:"moveByWords",motionArgs:{forward:!1,wordEnd:!1}},{keys:"B",type:"motion",motion:"moveByWords",motionArgs:{forward:!1,wordEnd:!1,bigWord:!0}},{keys:"ge",type:"motion",motion:"moveByWords",motionArgs:{forward:!1,wordEnd:!0,inclusive:!0}},{keys:"gE",type:"motion",motion:"moveByWords",motionArgs:{forward:!1,wordEnd:!0,bigWord:!0,inclusive:!0}},{keys:"{",type:"motion",motion:"moveByParagraph",motionArgs:{forward:!1,toJumplist:!0}},{keys:"}",type:"motion",motion:"moveByParagraph",motionArgs:{forward:!0,toJumplist:!0}},{keys:"<C-f>",type:"motion",motion:"moveByPage",motionArgs:{forward:!0}},{keys:"<C-b>",type:"motion",motion:"moveByPage",motionArgs:{forward:!1}},{keys:"<C-d>",type:"motion",motion:"moveByScroll",motionArgs:{forward:!0,explicitRepeat:!0}},{keys:"<C-u>",type:"motion",motion:"moveByScroll",motionArgs:{forward:!1,explicitRepeat:!0}},{keys:"gg",type:"motion",motion:"moveToLineOrEdgeOfDocument",motionArgs:{forward:!1,explicitRepeat:!0,linewise:!0,toJumplist:!0}},{keys:"G",type:"motion",motion:"moveToLineOrEdgeOfDocument",motionArgs:{forward:!0,explicitRepeat:!0,linewise:!0,toJumplist:!0}},{keys:"0",type:"motion",motion:"moveToStartOfLine"},{keys:"^",type:"motion",motion:"moveToFirstNonWhiteSpaceCharacter"},{keys:"+",type:"motion",motion:"moveByLines",motionArgs:{forward:!0,toFirstChar:!0}},{keys:"-",type:"motion",motion:"moveByLines",motionArgs:{forward:!1,toFirstChar:!0}},{keys:"_",type:"motion",motion:"moveByLines",motionArgs:{forward:!0,toFirstChar:!0,repeatOffset:-1}},{keys:"$",type:"motion",motion:"moveToEol",motionArgs:{inclusive:!0}},{keys:"%",type:"motion",motion:"moveToMatchedSymbol",motionArgs:{inclusive:!0,toJumplist:!0}},{keys:"f<character>",type:"motion",motion:"moveToCharacter",motionArgs:{forward:!0,inclusive:!0}},{keys:"F<character>",type:"motion",motion:"moveToCharacter",motionArgs:{forward:!1}},{keys:"t<character>",type:"motion",motion:"moveTillCharacter",motionArgs:{forward:!0,inclusive:!0}},{keys:"T<character>",type:"motion",motion:"moveTillCharacter",motionArgs:{forward:!1}},{keys:";",type:"motion",motion:"repeatLastCharacterSearch",motionArgs:{forward:!0}},{keys:",",type:"motion",motion:"repeatLastCharacterSearch",motionArgs:{forward:!1}},{keys:"'<character>",type:"motion",motion:"goToMark",motionArgs:{toJumplist:!0,linewise:!0}},{keys:"`<character>",type:"motion",motion:"goToMark",motionArgs:{toJumplist:!0}},{keys:"]`",type:"motion",motion:"jumpToMark",motionArgs:{forward:!0}},{keys:"[`",type:"motion",motion:"jumpToMark",motionArgs:{forward:!1}},{keys:"]'",type:"motion",motion:"jumpToMark",motionArgs:{forward:!0,linewise:!0}},{keys:"['",type:"motion",motion:"jumpToMark",motionArgs:{forward:!1,linewise:!0}},{keys:"]p",type:"action",action:"paste",isEdit:!0,actionArgs:{after:!0,isEdit:!0,matchIndent:!0}},{keys:"[p",type:"action",action:"paste",isEdit:!0,actionArgs:{after:!1,isEdit:!0,matchIndent:!0}},{keys:"]<character>",type:"motion",motion:"moveToSymbol",motionArgs:{forward:!0,toJumplist:!0}},{keys:"[<character>",type:"motion",motion:"moveToSymbol",motionArgs:{forward:!1,toJumplist:!0}},{keys:"|",type:"motion",motion:"moveToColumn"},{keys:"o",type:"motion",motion:"moveToOtherHighlightedEnd",context:"visual"},{keys:"O",type:"motion",motion:"moveToOtherHighlightedEnd",motionArgs:{sameLine:!0},context:"visual"},{keys:"d",type:"operator",operator:"delete"},{keys:"y",type:"operator",operator:"yank"},{keys:"c",type:"operator",operator:"change"},{keys:">",type:"operator",operator:"indent",operatorArgs:{indentRight:!0}},{keys:"<",type:"operator",operator:"indent",operatorArgs:{indentRight:!1}},{keys:"g~",type:"operator",operator:"changeCase"},{keys:"gu",type:"operator",operator:"changeCase",operatorArgs:{toLower:!0},isEdit:!0},{keys:"gU",type:"operator",operator:"changeCase",operatorArgs:{toLower:!1},isEdit:!0},{keys:"n",type:"motion",motion:"findNext",motionArgs:{forward:!0,toJumplist:!0}},{keys:"N",type:"motion",motion:"findNext",motionArgs:{forward:!1,toJumplist:!0}},{keys:"x",type:"operatorMotion",operator:"delete",motion:"moveByCharacters",motionArgs:{forward:!0},operatorMotionArgs:{visualLine:!1}},{keys:"X",type:"operatorMotion",operator:"delete",motion:"moveByCharacters",motionArgs:{forward:!1},operatorMotionArgs:{visualLine:!0}},{keys:"D",type:"operatorMotion",operator:"delete",motion:"moveToEol",motionArgs:{inclusive:!0},context:"normal"},{keys:"D",type:"operator",operator:"delete",operatorArgs:{linewise:!0},context:"visual"},{keys:"Y",type:"operatorMotion",operator:"yank",motion:"moveToEol",motionArgs:{inclusive:!0},context:"normal"},{keys:"Y",type:"operator",operator:"yank",operatorArgs:{linewise:!0},context:"visual"},{keys:"C",type:"operatorMotion",operator:"change",motion:"moveToEol",motionArgs:{inclusive:!0},context:"normal"},{keys:"C",type:"operator",operator:"change",operatorArgs:{linewise:!0},context:"visual"},{keys:"~",type:"operatorMotion",operator:"changeCase",motion:"moveByCharacters",motionArgs:{forward:!0},operatorArgs:{shouldMoveCursor:!0},context:"normal"},{keys:"~",type:"operator",operator:"changeCase",context:"visual"},{keys:"<C-w>",type:"operatorMotion",operator:"delete",motion:"moveByWords",motionArgs:{forward:!1,wordEnd:!1},context:"insert"},{keys:"<C-i>",type:"action",action:"jumpListWalk",actionArgs:{forward:!0}},{keys:"<C-o>",type:"action",action:"jumpListWalk",actionArgs:{forward:!1}},{keys:"<C-e>",type:"action",action:"scroll",actionArgs:{forward:!0,linewise:!0}},{keys:"<C-y>",type:"action",action:"scroll",actionArgs:{forward:!1,linewise:!0}},{keys:"a",type:"action",action:"enterInsertMode",isEdit:!0,actionArgs:{insertAt:"charAfter"},context:"normal"},{keys:"A",type:"action",action:"enterInsertMode",isEdit:!0,actionArgs:{insertAt:"eol"},context:"normal"},{keys:"A",type:"action",action:"enterInsertMode",isEdit:!0,actionArgs:{insertAt:"endOfSelectedArea"},context:"visual"},{keys:"i",type:"action",action:"enterInsertMode",isEdit:!0,actionArgs:{insertAt:"inplace"},context:"normal"},{keys:"I",type:"action",action:"enterInsertMode",isEdit:!0,actionArgs:{insertAt:"firstNonBlank"},context:"normal"},{keys:"I",type:"action",action:"enterInsertMode",isEdit:!0,actionArgs:{insertAt:"startOfSelectedArea"},context:"visual"},{keys:"o",type:"action",action:"newLineAndEnterInsertMode",isEdit:!0,interlaceInsertRepeat:!0,actionArgs:{after:!0},context:"normal"},{keys:"O",type:"action",action:"newLineAndEnterInsertMode",isEdit:!0,interlaceInsertRepeat:!0,actionArgs:{after:!1},context:"normal"},{keys:"v",type:"action",action:"toggleVisualMode"},{keys:"V",type:"action",action:"toggleVisualMode",actionArgs:{linewise:!0}},{keys:"<C-v>",type:"action",action:"toggleVisualMode",actionArgs:{blockwise:!0}},{keys:"<C-q>",type:"action",action:"toggleVisualMode",actionArgs:{blockwise:!0}},{keys:"gv",type:"action",action:"reselectLastSelection"},{keys:"J",type:"action",action:"joinLines",isEdit:!0},{keys:"p",type:"action",action:"paste",isEdit:!0,actionArgs:{after:!0,isEdit:!0}},{keys:"P",type:"action",action:"paste",isEdit:!0,actionArgs:{after:!1,isEdit:!0}},{keys:"r<character>",type:"action",action:"replace",isEdit:!0},{keys:"@<character>",type:"action",action:"replayMacro"},{keys:"q<character>",type:"action",action:"enterMacroRecordMode"},{keys:"R",type:"action",action:"enterInsertMode",isEdit:!0,actionArgs:{replace:!0}},{keys:"u",type:"action",action:"undo",context:"normal"},{keys:"u",type:"operator",operator:"changeCase",operatorArgs:{toLower:!0},context:"visual",isEdit:!0},{keys:"U",type:"operator",operator:"changeCase",operatorArgs:{toLower:!1},context:"visual",isEdit:!0},{keys:"<C-r>",type:"action",action:"redo"},{keys:"m<character>",type:"action",action:"setMark"},{keys:'"<character>',type:"action",action:"setRegister"},{keys:"zz",type:"action",action:"scrollToCursor",actionArgs:{position:"center"}},{keys:"z.",type:"action",action:"scrollToCursor",actionArgs:{position:"center"},motion:"moveToFirstNonWhiteSpaceCharacter"},{keys:"zt",type:"action",action:"scrollToCursor",actionArgs:{position:"top"}},{keys:"z<CR>",type:"action",action:"scrollToCursor",actionArgs:{position:"top"},motion:"moveToFirstNonWhiteSpaceCharacter"},{keys:"z-",type:"action",action:"scrollToCursor",actionArgs:{position:"bottom"}},{keys:"zb",type:"action",action:"scrollToCursor",actionArgs:{position:"bottom"},motion:"moveToFirstNonWhiteSpaceCharacter"},{keys:".",type:"action",action:"repeatLastEdit"},{keys:"<C-a>",type:"action",action:"incrementNumberToken",isEdit:!0,actionArgs:{increase:!0,backtrack:!1}},{keys:"<C-x>",type:"action",action:"incrementNumberToken",isEdit:!0,actionArgs:{increase:!1,backtrack:!1}},{keys:"<C-t>",type:"action",action:"indent",actionArgs:{indentRight:!0},context:"insert"},{keys:"<C-d>",type:"action",action:"indent",actionArgs:{indentRight:!1},context:"insert"},{keys:"a<character>",type:"motion",motion:"textObjectManipulation"},{keys:"i<character>",type:"motion",motion:"textObjectManipulation",motionArgs:{textObjectInner:!0}},{keys:"/",type:"search",searchArgs:{forward:!0,querySrc:"prompt",toJumplist:!0}},{keys:"?",type:"search",searchArgs:{forward:!1,querySrc:"prompt",toJumplist:!0}},{keys:"*",type:"search",searchArgs:{forward:!0,querySrc:"wordUnderCursor",wholeWordOnly:!0,toJumplist:!0}},{keys:"#",type:"search",searchArgs:{forward:!1,querySrc:"wordUnderCursor",wholeWordOnly:!0,toJumplist:!0}},{keys:"g*",type:"search",searchArgs:{forward:!0,querySrc:"wordUnderCursor",toJumplist:!0}},{keys:"g#",type:"search",searchArgs:{forward:!1,querySrc:"wordUnderCursor",toJumplist:!0}},{keys:":",type:"ex"}],bz=[{name:"colorscheme",shortName:"colo"},{name:"map"},{name:"imap",shortName:"im"},{name:"nmap",shortName:"nm"},{name:"vmap",shortName:"vm"},{name:"unmap"},{name:"write",shortName:"w"},{name:"undo",shortName:"u"},{name:"redo",shortName:"red"},{name:"set",shortName:"se"},{name:"set",shortName:"se"},{name:"setlocal",shortName:"setl"},{name:"setglobal",shortName:"setg"},{name:"sort",shortName:"sor"},{name:"substitute",shortName:"s",possiblyAsync:!0},{name:"nohlsearch",shortName:"noh"},{name:"yank",shortName:"y"},{name:"delmarks",shortName:"delm"},{name:"registers",shortName:"reg",excludeFromCommandHistory:!0},{name:"global",shortName:"g"}],cE=bB.Pos,cf=function(){return aU};bB.defineOption("vimMode",!1,function(b,a,c){a&&b.getOption("keyMap")!="vim"?b.setOption("keyMap","vim"):!a&&c!=bB.Init&&/^vim/.test(b.getOption("keyMap"))&&b.setOption("keyMap","default")});var cu={Shift:"S",Ctrl:"C",Alt:"A",Cmd:"D",Mod:"A"},cJ={Enter:"CR",Backspace:"BS",Delete:"Del",Insert:"Ins"},b4=/[\d]/,cF=[bB.isWordChar,function(a){return a&&!bB.isWordChar(a)&&!/\s/.test(a)}],ck=[function(a){return/\S/.test(a)}],cI=cA(65,26),bR=cA(97,26),cC=cA(48,10),cy=[].concat(cI,bR,cC,["<",">"]),bH=[].concat(cI,bR,cC,["-",'"',".",":","/"]),cx={};cw("filetype",undefined,"string",["ft"],function(b,a){if(a===undefined){return}if(b===undefined){var c=a.getOption("mode");return c=="null"?"":c}var c=b==""?"null":b;a.setOption("mode",c)});var b8=function(){function c(k,n,j){function i(s){var l=++b%f,q=a[l];q&&q.clear(),a[l]=k.setBookmark(s)}var e=b%f,m=a[e];if(m){var p=m.find();p&&!a0(p,n)&&i(n)}else{i(n)}i(j),h=b,d=b-f+1,d<0&&(d=0)}function g(k,n){b+=n,b>h?b=h:b<d&&(b=d);var j=a[(f+b)%f];if(j&&!j.find()){var i=n>0?1:-1,m,e=k.getCursor();do{b+=i,j=a[(f+b)%f];if(j&&(m=j.find())&&!a0(e,m)){break}}while(b<h&&b>d)}return j}var f=100,b=-1,h=0,d=0,a=new Array(f);return{cachedCursor:undefined,add:c,move:g}},b6=function(a){return a?{changes:a.changes,expectCursorActivityForChange:a.expectCursorActivityForChange}:{changes:[],expectCursorActivityForChange:!1}};bc.prototype={exitMacroRecordMode:function(){var a=cl.macroModeState;a.onRecordingDone&&a.onRecordingDone(),a.onRecordingDone=undefined,a.isRecording=!1},enterMacroRecordMode:function(b,a){var c=cl.registerController.getRegister(a);c&&(c.clear(),this.latestRegister=a,b.openDialog&&(this.onRecordingDone=b.openDialog("(recording)["+a+"]",null,{bottom:!0})),this.isRecording=!0)}};var cl,ax,aU={buildKeyMap:function(){},getRegisterController:function(){return cl.registerController},resetVimGlobalState_:a6,getVimGlobalState_:function(){return cl},maybeInitVimState_:aL,suppressErrorLogging:!1,InsertModeKey:bd,map:function(b,a,c){ai.map(b,a,c)},unmap:function(b,a){ai.unmap(b,a)},setOption:ci,getOption:cB,defineOption:cw,defineEx:function(b,a,c){if(!a){a=b}else{if(b.indexOf(a)!==0){throw new Error('(Vim.defineEx) "'+a+'" is not a prefix of "'+b+'", command not registered')}}bi[b]=c,ai.commandMap_[a]={name:b,shortName:a,type:"api"}},handleKey:function(c,a,d){var b=this.findKey(c,a,d);if(typeof b=="function"){return b()}},findKey:function(j,m,d){function g(){var a=cl.macroModeState;if(a.isRecording){if(m=="q"){return a.exitMacroRecordMode(),aB(j),!0}d!="mapping"&&cq(a,m)}}function p(){if(m=="<Esc>"){return aB(j),b.visualMode?cg(j):b.insertMode&&cL(j),!0}}function c(e){var a;while(e){a=/<\w+-.+?>|<\w+>|./.exec(e),m=a[0],e=e.substring(a.index+m.length),bB.Vim.handleKey(j,m,"mapping")}}function l(){if(p()){return !0}var w=b.inputState.keyBuffer=b.inputState.keyBuffer+m,s=m.length==1,v=aG.matchCommand(w,b2,b.inputState,"insert");while(w.length>1&&v.type!="full"){var w=b.inputState.keyBuffer=w.slice(1),r=aG.matchCommand(w,b2,b.inputState,"insert");r.type!="none"&&(v=r)}if(v.type=="none"){return aB(j),!1}if(v.type=="partial"){return ax&&window.clearTimeout(ax),ax=window.setTimeout(function(){b.insertMode&&b.inputState.keyBuffer&&aB(j)},cB("insertModeEscKeysTimeout")),!s}ax&&window.clearTimeout(ax);if(s){var q=j.listSelections();for(var t=0;t<q.length;t++){var e=q[t].head;j.replaceRange("",c3(e,0,-(w.length-1)),e,"+input")}cl.macroModeState.lastInsertModeChanges.changes.pop()}return aB(j),v.command}function k(){if(g()||p()){return !0}var q=b.inputState.keyBuffer=b.inputState.keyBuffer+m;if(/^[1-9]\d*$/.test(q)){return !0}var i=/^(\d*)(.*)$/.exec(q);if(!i){return aB(j),!1}var f=b.visualMode?"visual":"normal",e=aG.matchCommand(i[2]||i[1],b2,b.inputState,f);if(e.type=="none"){return aB(j),!1}if(e.type=="partial"){return !0}b.inputState.keyBuffer="";var i=/^(\d*)(.*)$/.exec(q);return i[1]&&i[1]!="0"&&b.inputState.pushRepeatDigit(i[1]),e.command}var b=aL(j),h;return b.insertMode?h=l():h=k(),h===!1?undefined:h===!0?function(){return !0}:function(){if((h.operator||h.isEdit)&&j.getOption("readOnly")){return}return j.operation(function(){j.curOp.isVimOp=!0;try{h.type=="keyToKey"?c(h.toKeys):aG.processCommand(j,b,h)}catch(a){throw j.state.vim=undefined,aL(j),bB.Vim.suppressErrorLogging||console.log(a),a}return !0})}},handleEx:function(b,a){ai.processCommand(b,a)},defineMotion:bl,defineAction:b7,defineOperator:aQ,mapCommand:bk,_mapCommand:bu,defineRegister:a1,exitVisualMode:cg,exitInsertMode:cL};bM.prototype.pushRepeatDigit=function(a){this.operator?this.motionRepeat=this.motionRepeat.concat(a):this.prefixRepeat=this.prefixRepeat.concat(a)},bM.prototype.getRepeat=function(){var a=0;if(this.prefixRepeat.length>0||this.motionRepeat.length>0){a=1,this.prefixRepeat.length>0&&(a*=parseInt(this.prefixRepeat.join(""),10)),this.motionRepeat.length>0&&(a*=parseInt(this.motionRepeat.join(""),10))}return a},cM.prototype={setText:function(b,a,c){this.keyBuffer=[b||""],this.linewise=!!a,this.blockwise=!!c},pushText:function(b,a){a&&(this.linewise||this.keyBuffer.push("\n"),this.linewise=!0),this.keyBuffer.push(b)},pushInsertModeChanges:function(a){this.insertModeChanges.push(b6(a))},pushSearchQuery:function(a){this.searchQueries.push(a)},clear:function(){this.keyBuffer=[],this.insertModeChanges=[],this.searchQueries=[],this.linewise=!1},toString:function(){return this.keyBuffer.join("")}},cZ.prototype={pushText:function(f,b,h,d,a){d&&h.charAt(h.length-1)!=="\n"&&(h+="\n");var c=this.isValidRegister(f)?this.getRegister(f):null;if(!c){switch(b){case"yank":this.registers[0]=new cM(h,d,a);break;case"delete":case"change":h.indexOf("\n")==-1?this.registers["-"]=new cM(h,d):(this.shiftNumericRegisters_(),this.registers[1]=new cM(h,d))}this.unnamedRegister.setText(h,d,a);return}var g=b9(f);g?c.pushText(h,d):c.setText(h,d,a),this.unnamedRegister.setText(c.toString(),d)},getRegister:function(a){return this.isValidRegister(a)?(a=a.toLowerCase(),this.registers[a]||(this.registers[a]=new cM),this.registers[a]):this.unnamedRegister},isValidRegister:function(a){return a&&cV(a,bH)},shiftNumericRegisters_:function(){for(var a=9;a>=2;a--){this.registers[a]=this.getRegister(""+(a-1))}}},bx.prototype={nextMatch:function(f,b){var h=this.historyBuffer,d=b?-1:1;this.initialPrefix===null&&(this.initialPrefix=f);for(var a=this.iterator+d;b?a>=0:a<h.length;a+=d){var c=h[a];for(var g=0;g<=c.length;g++){if(this.initialPrefix==c.substring(0,g)){return this.iterator=a,c}}}if(a>=h.length){return this.iterator=h.length,this.initialPrefix}if(a<0){return f}},pushInput:function(b){var a=this.historyBuffer.indexOf(b);a>-1&&this.historyBuffer.splice(a,1),b.length&&this.historyBuffer.push(b)},reset:function(){this.initialPrefix=null,this.iterator=this.historyBuffer.length}};var aG={matchCommand:function(g,k,d,b){var f=cT(g,k,b,d);if(!f.full&&!f.partial){return{type:"none"}}if(!f.full&&f.partial){return{type:"partial"}}var l;for(var c=0;c<f.full.length;c++){var j=f.full[c];l||(l=j)}if(l.keys.slice(-11)=="<character>"){var h=aF(g);if(/<C-.>/.test(h)){return{type:"none"}}d.selectedCharacter=h}return{type:"full",command:l}},processCommand:function(b,a,c){a.inputState.repeatOverride=c.repeatOverride;switch(c.type){case"motion":this.processMotion(b,a,c);break;case"operator":this.processOperator(b,a,c);break;case"operatorMotion":this.processOperatorMotion(b,a,c);break;case"action":this.processAction(b,a,c);break;case"search":this.processSearch(b,a,c);break;case"ex":case"keyToEx":this.processEx(b,a,c);break;default:}},processMotion:function(b,a,c){a.inputState.motion=c.motion,a.inputState.motionArgs=ak(c.motionArgs),this.evalInput(b,a)},processOperator:function(c,a,d){var b=a.inputState;if(b.operator){if(b.operator==d.operator){b.motion="expandToLine",b.motionArgs={linewise:!0},this.evalInput(c,a);return}aB(c)}b.operator=d.operator,b.operatorArgs=ak(d.operatorArgs),a.visualMode&&this.evalInput(c,a)},processOperatorMotion:function(d,b,f){var c=b.visualMode,a=ak(f.operatorMotionArgs);a&&c&&a.visualLine&&(b.visualLine=!0),this.processOperator(d,b,f),c||this.processMotion(d,b,f)},processAction:function(f,b,h){var d=b.inputState,a=d.getRepeat(),c=!!a,g=ak(h.actionArgs)||{};d.selectedCharacter&&(g.selectedCharacter=d.selectedCharacter),h.operator&&this.processOperator(f,b,h),h.motion&&this.processMotion(f,b,h),(h.motion||h.operator)&&this.evalInput(f,b),g.repeat=a||1,g.repeatIsExplicit=c,g.registerName=d.registerName,aB(f),b.lastMotion=null,h.isEdit&&this.recordLastEdit(b,d,h),cU[h.action](f,g,b)},processSearch:function(z,E,k){function C(d,a,c){cl.searchHistoryController.pushInput(d),cl.searchHistoryController.reset();try{a8(z,d,a,c)}catch(e){aI(z,"Invalid regex: "+d),aB(z);return}aG.processMotion(z,E,{type:"motion",motion:"findNext",motionArgs:{forward:!0,toJumplist:k.searchArgs.toJumplist}})}function y(a){z.scrollTo(D.left,D.top),C(a,!0,!0);var c=cl.macroModeState;c.isRecording&&bq(c,a)}function v(e,p,d){var h=bB.keyName(e),m,c;h=="Up"||h=="Down"?(m=h=="Up"?!0:!1,c=e.target?e.target.selectionEnd:0,p=cl.searchHistoryController.nextMatch(p,m)||"",d(p),c&&e.target&&(e.target.selectionEnd=e.target.selectionStart=Math.min(c,e.target.value.length))):h!="Left"&&h!="Right"&&h!="Ctrl"&&h!="Alt"&&h!="Shift"&&cl.searchHistoryController.reset();var l;try{l=a8(z,p,!0,!0)}catch(e){}l?z.scrollIntoView(aD(z,!b,l),30):(cR(z),z.scrollTo(D.left,D.top))}function B(c,e,d){var a=bB.keyName(c);a=="Esc"||a=="Ctrl-C"||a=="Ctrl-["||a=="Backspace"&&e==""?(cl.searchHistoryController.pushInput(e),cl.searchHistoryController.reset(),a8(z,j),cR(z),z.scrollTo(D.left,D.top),bB.e_stop(c),aB(z),d(),z.focus()):a=="Up"||a=="Down"?bB.e_stop(c):a=="Ctrl-U"&&(bB.e_stop(c),d(""))}if(!z.getSearchCursor){return}var b=k.searchArgs.forward,w=k.searchArgs.wholeWordOnly;bm(z).setReversed(!b);var F=b?"/":"?",j=bm(z).getQuery(),D=z.getScrollInfo();switch(k.searchArgs.querySrc){case"prompt":var x=cl.macroModeState;if(x.isPlaying){var g=x.replaySearchQueries.shift();C(g,!0,!1)}else{a3(z,{onClose:y,prefix:F,desc:bh,onKeyUp:v,onKeyDown:B})}break;case"wordUnderCursor":var A=cY(z,!1,!0,!1,!0),q=!0;A||(A=cY(z,!1,!0,!1,!1),q=!1);if(!A){return}var g=z.getLine(A.start.line).substring(A.start.ch,A.end.ch);q&&w?g="\\b"+g+"\\b":g=aP(g),cl.jumpList.cachedCursor=z.getCursor(),z.setCursor(A.start),C(g,!0,!1)}},processEx:function(d,b,f){function c(e){cl.exCommandHistoryController.pushInput(e),cl.exCommandHistoryController.reset(),ai.processCommand(d,e)}function a(g,l,j){var e=bB.keyName(g),h,k;if(e=="Esc"||e=="Ctrl-C"||e=="Ctrl-["||e=="Backspace"&&l==""){cl.exCommandHistoryController.pushInput(l),cl.exCommandHistoryController.reset(),bB.e_stop(g),aB(d),j(),d.focus()}e=="Up"||e=="Down"?(bB.e_stop(g),h=e=="Up"?!0:!1,k=g.target?g.target.selectionEnd:0,l=cl.exCommandHistoryController.nextMatch(l,h)||"",j(l),k&&g.target&&(g.target.selectionEnd=g.target.selectionStart=Math.min(k,g.target.value.length))):e=="Ctrl-U"?(bB.e_stop(g),j("")):e!="Left"&&e!="Right"&&e!="Ctrl"&&e!="Alt"&&e!="Shift"&&cl.exCommandHistoryController.reset()}f.type=="keyToEx"?ai.processCommand(d,f.exArgs.input):b.visualMode?a3(d,{onClose:c,prefix:":",value:"'<,'>",onKeyDown:a,selectValueOnOpen:!1}):a3(d,{onClose:c,prefix:":",onKeyDown:a})},evalInput:function(cn,K){var X=K.inputState,R=X.motion,ar=X.motionArgs||{},P=X.operator,W=X.operatorArgs||{},J=X.registerName,c8=K.sel,bt=bf(K.visualMode?ah(cn,c8.head):cn.getCursor("head")),Z=bf(K.visualMode?ah(cn,c8.anchor):cn.getCursor("anchor")),ct=bf(bt),at=bf(Z),V,cr,I;P&&this.recordLastEdit(K,X),X.repeatOverride!==undefined?I=X.repeatOverride:I=X.getRepeat();if(I>0&&ar.explicitRepeat){ar.repeatIsExplicit=!0}else{if(ar.noRepeat||!ar.explicitRepeat&&I===0){I=1,ar.repeatIsExplicit=!1}}X.selectedCharacter&&(ar.selectedCharacter=W.selectedCharacter=X.selectedCharacter),ar.repeat=I,aB(cn);if(R){var Y=bp[R](cn,bt,ar,K);K.lastMotion=bp[R];if(!Y){return}if(ar.toJumplist){!P&&cn.ace.curOp!=null&&(cn.ace.curOp.command.scrollIntoView="center-animate");var bn=cl.jumpList,F=bn.cachedCursor;F?(ba(cn,F,Y),delete bn.cachedCursor):ba(cn,bt,Y)}Y instanceof Array?(cr=Y[0],V=Y[1]):V=Y,V||(V=bf(bt));if(K.visualMode){if(!K.visualBlock||V.ch!==Infinity){V=ah(cn,V,K.visualBlock)}cr&&(cr=ah(cn,cr,!0)),cr=cr||at,c8.anchor=cr,c8.head=V,bs(cn),cO(cn,K,"<",aK(cr,V)?cr:V),cO(cn,K,">",aK(cr,V)?V:cr)}else{P||(V=ah(cn,V),cn.setCursor(V.line,V.ch))}}if(P){if(W.lastSel){cr=at;var c7=W.lastSel,H=Math.abs(c7.head.line-c7.anchor.line),q=Math.abs(c7.head.ch-c7.anchor.ch);c7.visualLine?V=cE(at.line+H,at.ch):c7.visualBlock?V=cE(at.line+H,at.ch+q):c7.head.line==c7.anchor.line?V=cE(at.line,at.ch+q):V=cE(at.line+H,at.ch),K.visualMode=!0,K.visualLine=c7.visualLine,K.visualBlock=c7.visualBlock,c8=K.sel={anchor:cr,head:V},bs(cn)}else{K.visualMode&&(W.lastSel={anchor:bf(c8.anchor),head:bf(c8.head),visualBlock:K.visualBlock,visualLine:K.visualLine})}var G,j,B,Q,an;if(K.visualMode){G=a5(c8.head,c8.anchor),j=aa(c8.head,c8.anchor),B=K.visualLine||W.linewise,Q=K.visualBlock?"block":B?"line":"char",an=bj(cn,{anchor:G,head:j},Q);if(B){var E=an.ranges;if(Q=="block"){for(var U=0;U<E.length;U++){E[U].head.ch=aA(cn,E[U].head.line)}}else{Q=="line"&&(E[0].head=cE(E[0].head.line+1,0))}}}else{G=bf(cr||at),j=bf(V||ct);if(aK(j,G)){var z=G;G=j,j=z}B=ar.linewise||W.linewise,B?bo(cn,G,j):ar.forward&&bJ(cn,G,j),Q="char";var D=!ar.inclusive||B;an=bj(cn,{anchor:G,head:j},Q,D)}cn.setSelections(an.ranges,an.primary),K.lastMotion=null,W.repeat=I,W.registerName=J,W.linewise=B;var c9=cQ[P](cn,W,an.ranges,at,V);K.visualMode&&cg(cn,c9!=null),c9&&cn.setCursor(c9)}},recordLastEdit:function(c,a,d){var b=cl.macroModeState;if(b.isPlaying){return}c.lastEditInputState=a,c.lastEditActionCommand=d,b.lastInsertModeChanges.changes=[],b.lastInsertModeChanges.expectCursorActivityForChange=!1}},bp={moveToTopLine:function(c,a,d){var b=ao(c).top+d.repeat-1;return cE(b,ap(c.getLine(b)))},moveToMiddleLine:function(b){var a=ao(b),c=Math.floor((a.top+a.bottom)*0.5);return cE(c,ap(b.getLine(c)))},moveToBottomLine:function(c,a,d){var b=ao(c).bottom-d.repeat+1;return cE(b,ap(c.getLine(b)))},expandToLine:function(c,a,d){var b=a;return cE(b.line+d.repeat-1,Infinity)},findNext:function(f,b,g){var d=bm(f),a=d.getQuery();if(!a){return}var c=!g.forward;return c=d.isReversed()?!c:c,az(f,a),aD(f,c,a,g.repeat)},goToMark:function(d,b,f,c){var a=ae(d,c,f.selectedCharacter);return a?f.linewise?{line:a.line,ch:ap(d.getLine(a.line))}:a:null},moveToOtherHighlightedEnd:function(d,b,f,c){if(c.visualBlock&&f.sameLine){var a=c.sel;return[ah(d,cE(a.anchor.line,a.head.ch)),ah(d,cE(a.head.line,a.anchor.ch))]}return[c.sel.head,c.sel.anchor]},jumpToMark:function(m,w,g,b){var j=w;for(var x=0;x<g.repeat;x++){var d=j;for(var v in b.marks){if(!cc(v)){continue}var q=b.marks[v].find(),k=g.forward?aK(q,d):aK(d,q);if(k){continue}if(g.linewise&&q.line==d.line){continue}var h=a0(d,j),p=g.forward?aw(d,q,j):aw(j,q,d);if(h||p){j=q}}}return g.linewise&&(j=cE(j.line,ap(m.getLine(j.line)))),j},moveByCharacters:function(f,b,g){var d=b,a=g.repeat,c=g.forward?d.ch+a:d.ch-a;return cE(d.line,c)},moveByLines:function(k,q,d,b){var h=q,v=h.ch;switch(b.lastMotion){case this.moveByLines:case this.moveByDisplayLines:case this.moveByScroll:case this.moveToColumn:case this.moveToEol:v=b.lastHPos;break;default:b.lastHPos=v}var c=d.repeat+(d.repeatOffset||0),p=d.forward?h.line+c:h.line-c,m=k.firstLine(),j=k.lastLine();if(p<m&&h.line==m){return this.moveToStartOfLine(k,q,d,b)}if(p>j&&h.line==j){return this.moveToEol(k,q,d,b)}var g=k.ace.session.getFoldLine(p);return g&&(d.forward?p>g.start.row&&(p=g.end.row+1):p=g.start.row),d.toFirstChar&&(v=ap(k.getLine(p)),b.lastHPos=v),b.lastHSPos=k.charCoords(cE(p,v),"div").left,cE(p,v)},moveByDisplayLines:function(j,m,d,b){var g=m;switch(b.lastMotion){case this.moveByDisplayLines:case this.moveByScroll:case this.moveByLines:case this.moveToColumn:case this.moveToEol:break;default:b.lastHSPos=j.charCoords(g,"div").left}var p=d.repeat,c=j.findPosV(g,d.forward?p:-p,"line",b.lastHSPos);if(c.hitSide){if(d.forward){var l=j.charCoords(c,"div"),k={top:l.top+8,left:b.lastHSPos},c=j.coordsChar(k,"div")}else{var h=j.charCoords(cE(j.firstLine(),0),"div");h.left=b.lastHSPos,c=j.coordsChar(h,"div")}}return b.lastHPos=c.ch,c},moveByPage:function(d,b,f){var c=b,a=f.repeat;return d.findPosV(c,f.forward?a:-a,"page")},moveByParagraph:function(c,a,d){var b=d.forward?1:-1;return c2(c,a,d.repeat,b)},moveByScroll:function(g,k,d,b){var f=g.getScrollInfo(),l=null,c=d.repeat;c||(c=f.clientHeight/(2*g.defaultTextHeight()));var j=g.charCoords(k,"local");d.repeat=c;var l=bp.moveByDisplayLines(g,k,d,b);if(!l){return null}var h=g.charCoords(l,"local");return g.scrollTo(null,f.top+h.top-j.top),l},moveByWords:function(b,a,c){return aX(b,a,c.repeat,!!c.forward,!!c.wordEnd,!!c.bigWord)},moveTillCharacter:function(f,b,g){var d=g.repeat,a=bV(f,d,g.forward,g.selectedCharacter),c=g.forward?-1:1;return aY(c,g),a?(a.ch+=c,a):null},moveToCharacter:function(c,a,d){var b=d.repeat;return aY(0,d),bV(c,b,d.forward,d.selectedCharacter)||a},moveToSymbol:function(c,a,d){var b=d.repeat;return cz(c,b,d.forward,d.selectedCharacter)||a},moveToColumn:function(d,b,f,c){var a=f.repeat;return c.lastHPos=a-1,c.lastHSPos=d.charCoords(b,"div").left,aE(d,a)},moveToEol:function(f,b,h,d){var a=b;d.lastHPos=Infinity;var c=cE(a.line+h.repeat-1,Infinity),g=f.clipPos(c);return g.ch--,d.lastHSPos=f.charCoords(g,"div").left,c},moveToFirstNonWhiteSpaceCharacter:function(b,a){var c=a;return cE(c.line,ap(b.getLine(c.line)))},moveToMatchedSymbol:function(g,k){var d=k,b=d.line,f=d.ch,l=g.getLine(b),c;do{c=l.charAt(f++);if(c&&bv(c)){var j=g.getTokenTypeAt(cE(b,f));if(j!=="string"&&j!=="comment"){break}}}while(c);if(c){var h=g.findMatchingBracket(cE(b,f));return h.to}return d},moveToStartOfLine:function(b,a){return cE(a.line,0)},moveToLineOrEdgeOfDocument:function(c,a,d){var b=d.forward?c.lastLine():c.firstLine();return d.repeatIsExplicit&&(b=d.repeat-c.getOption("firstLineNumber")),cE(b,ap(c.getLine(b)))},textObjectManipulation:function(j,m,d,b){var g={"(":")",")":"(","{":"}","}":"{","[":"]","]":"["},p={"'":!0,'"':!0},c=d.selectedCharacter;c=="b"?c="(":c=="B"&&(c="{");var l=!d.textObjectInner,k;if(g[c]){k=bF(j,m,c,l)}else{if(p[c]){k=aJ(j,m,c,l)}else{if(c==="W"){k=cY(j,l,!0,!0)}else{if(c==="w"){k=cY(j,l,!0,!1)}else{if(c!=="p"){return null}k=c2(j,m,d.repeat,0,l),d.linewise=!0;if(b.visualMode){b.visualLine||(b.visualLine=!0)}else{var h=b.inputState.operatorArgs;h&&(h.linewise=!0),k.end.line--}}}}}return j.state.vim.visualMode?cG(j,k.start,k.end):[k.start,k.end]},repeatLastCharacterSearch:function(g,c,j){var f=cl.lastCharacterSearch,b=j.repeat,d=j.forward===f.forward,h=(f.increment?1:0)*(d?-1:1);g.moveH(-h,"char"),j.inclusive=d?!0:!1;var a=bV(g,b,d,f.selectedCharacter);return a?(a.ch+=h,a):(g.moveH(h,"char"),c)}},cQ={change:function(q,y,g){var b,k,z=q.state.vim;cl.macroModeState.lastInsertModeChanges.inVisualBlock=z.visualBlock;if(!z.visualMode){var d=g[0].anchor,x=g[0].head;k=q.getRange(d,x);var w=z.lastEditInputState||{};if(w.motion=="moveByWords"&&!cb(k)){var p=/\s+$/.exec(k);p&&w.motionArgs&&w.motionArgs.forward&&(x=c3(x,0,-p[0].length),k=k.slice(0,-p[0].length))}var j=new cE(d.line-1,Number.MAX_VALUE),v=q.firstLine()==q.lastLine();x.line>q.lastLine()&&y.linewise&&!v?q.replaceRange("",j,x):q.replaceRange("",d,x),y.linewise&&(v||(q.setCursor(j),bB.commands.newlineAndIndent(q)),d.ch=Number.MAX_VALUE),b=d}else{k=q.getSelection();var m=aq("",g.length);q.replaceSelections(m),b=a5(g[0].head,g[0].anchor)}cl.registerController.pushText(y.registerName,"change",k,y.linewise,g.length>1),cU.enterInsertMode(q,{head:b},q.state.vim)},"delete":function(j,m,d){var b,g,p=j.state.vim;if(!p.visualBlock){var c=d[0].anchor,l=d[0].head;m.linewise&&l.line!=j.firstLine()&&c.line==j.lastLine()&&c.line==l.line-1&&(c.line==j.firstLine()?c.ch=0:c=cE(c.line-1,aA(j,c.line-1))),g=j.getRange(c,l),j.replaceRange("",c,l),b=c,m.linewise&&(b=bp.moveToFirstNonWhiteSpaceCharacter(j,c))}else{g=j.getSelection();var k=aq("",d.length);j.replaceSelections(k),b=d[0].anchor}cl.registerController.pushText(m.registerName,"delete",g,m.linewise,p.visualBlock);var h=p.insertMode;return ah(j,b,h)},indent:function(g,k,d){var b=g.state.vim,f=d[0].anchor.line,l=b.visualBlock?d[d.length-1].anchor.line:d[0].head.line,c=b.visualMode?k.repeat:1;k.linewise&&l--;for(var j=f;j<=l;j++){for(var h=0;h<c;h++){g.indentLine(j,k.indentRight)}}return bp.moveToFirstNonWhiteSpaceCharacter(g,d[0].anchor)},changeCase:function(q,y,g,b,k){var z=q.getSelections(),d=[],x=y.toLower;for(var w=0;w<z.length;w++){var p=z[w],j="";if(x===!0){j=p.toLowerCase()}else{if(x===!1){j=p.toUpperCase()}else{for(var v=0;v<p.length;v++){var m=p.charAt(v);j+=b9(m)?m.toLowerCase():m.toUpperCase()}}}d.push(j)}return q.replaceSelections(d),y.shouldMoveCursor?k:!q.state.vim.visualMode&&y.linewise&&g[0].anchor.line+1==g[0].head.line?bp.moveToFirstNonWhiteSpaceCharacter(q,b):y.linewise?b:a5(g[0].anchor,g[0].head)},yank:function(f,b,h,d){var a=f.state.vim,c=f.getSelection(),g=a.visualMode?a5(a.sel.anchor,a.sel.head,h[0].head,h[0].anchor):d;return cl.registerController.pushText(b.registerName,"yank",c,b.linewise,a.visualBlock),g}},cU={jumpListWalk:function(g,c,j){if(j.visualMode){return}var f=c.repeat,b=c.forward,d=cl.jumpList,h=d.move(g,b?f:-f),a=h?h.find():undefined;a=a?a:g.getCursor(),g.setCursor(a),g.ace.curOp.command.scrollIntoView="center-animate"},scroll:function(k,q,d){if(d.visualMode){return}var b=q.repeat||1,h=k.defaultTextHeight(),v=k.getScrollInfo().top,c=h*b,p=q.forward?v+c:v-c,m=bf(k.getCursor()),j=k.charCoords(m,"local");if(q.forward){p>j.top?(m.line+=(p-j.top)/h,m.line=Math.ceil(m.line),k.setCursor(m),j=k.charCoords(m,"local"),k.scrollTo(null,j.top)):k.scrollTo(null,p)}else{var g=p+k.getScrollInfo().clientHeight;g<j.bottom?(m.line-=(j.bottom-g)/h,m.line=Math.floor(m.line),k.setCursor(m),j=k.charCoords(m,"local"),k.scrollTo(null,j.bottom-k.getScrollInfo().clientHeight)):k.scrollTo(null,p)}},scrollToCursor:function(f,b){var h=f.getCursor().line,d=f.charCoords(cE(h,0),"local"),a=f.getScrollInfo().clientHeight,c=d.top,g=d.bottom-c;switch(b.position){case"center":c=c-a/2+g;break;case"bottom":c=c-a+g*1.4;break;case"top":c+=g*0.4}f.scrollTo(null,c)},replayMacro:function(f,b,g){var d=b.selectedCharacter,a=b.repeat,c=cl.macroModeState;d=="@"&&(d=c.latestRegister);while(a--){b5(f,g,c,d)}},enterMacroRecordMode:function(c,a){var d=cl.macroModeState,b=a.selectedCharacter;cl.registerController.isValidRegister(b)&&d.enterMacroRecordMode(c,b)},toggleOverwrite:function(a){a.state.overwrite?(a.toggleOverwrite(!1),a.setOption("keyMap","vim-insert"),bB.signal(a,"vim-mode-change",{mode:"insert"})):(a.toggleOverwrite(!0),a.setOption("keyMap","vim-replace"),bB.signal(a,"vim-mode-change",{mode:"replace"}))},enterInsertMode:function(f,b,h){if(f.getOption("readOnly")){return}h.insertMode=!0,h.insertModeRepeat=b&&b.repeat||1;var d=b?b.insertAt:null,a=h.sel,c=b.head||f.getCursor("head"),g=f.listSelections().length;if(d=="eol"){c=cE(c.line,aA(f,c.line))}else{if(d=="charAfter"){c=c3(c,0,1)}else{if(d=="firstNonBlank"){c=bp.moveToFirstNonWhiteSpaceCharacter(f,c)}else{if(d=="startOfSelectedArea"){h.visualBlock?(c=cE(Math.min(a.head.line,a.anchor.line),Math.min(a.head.ch,a.anchor.ch)),g=Math.abs(a.head.line-a.anchor.line)+1):a.head.line<a.anchor.line?c=a.head:c=cE(a.anchor.line,0)}else{if(d=="endOfSelectedArea"){h.visualBlock?(c=cE(Math.min(a.head.line,a.anchor.line),Math.max(a.head.ch+1,a.anchor.ch)),g=Math.abs(a.head.line-a.anchor.line)+1):a.head.line>=a.anchor.line?c=c3(a.head,0,1):c=cE(a.anchor.line,0)}else{if(d=="inplace"&&h.visualMode){return}}}}}}f.setOption("disableInput",!1),b&&b.replace?(f.toggleOverwrite(!0),f.setOption("keyMap","vim-replace"),bB.signal(f,"vim-mode-change",{mode:"replace"})):(f.toggleOverwrite(!1),f.setOption("keyMap","vim-insert"),bB.signal(f,"vim-mode-change",{mode:"insert"})),cl.macroModeState.isPlaying||(f.on("change",au),bB.on(f.getInputField(),"keydown",aM)),h.visualMode&&cg(f),cj(f,c,g)},toggleVisualMode:function(f,b,g){var d=b.repeat,a=f.getCursor(),c;g.visualMode?g.visualLine^b.linewise||g.visualBlock^b.blockwise?(g.visualLine=!!b.linewise,g.visualBlock=!!b.blockwise,bB.signal(f,"vim-mode-change",{mode:"visual",subMode:g.visualLine?"linewise":g.visualBlock?"blockwise":""}),bs(f)):cg(f):(g.visualMode=!0,g.visualLine=!!b.linewise,g.visualBlock=!!b.blockwise,c=ah(f,cE(a.line,a.ch+d-1),!0),g.sel={anchor:a,head:c},bB.signal(f,"vim-mode-change",{mode:"visual",subMode:g.visualLine?"linewise":g.visualBlock?"blockwise":""}),bs(f),cO(f,g,"<",a5(a,c)),cO(f,g,">",aa(a,c)))},reselectLastSelection:function(f,b,g){var d=g.lastSelection;g.visualMode&&cD(f,g);if(d){var a=d.anchorMark.find(),c=d.headMark.find();if(!a||!c){return}g.sel={anchor:a,head:c},g.visualMode=!0,g.visualLine=d.visualLine,g.visualBlock=d.visualBlock,bs(f),cO(f,g,"<",a5(a,c)),cO(f,g,">",aa(a,c)),bB.signal(f,"vim-mode-change",{mode:"visual",subMode:g.visualLine?"linewise":g.visualBlock?"blockwise":""})}},joinLines:function(k,q,d){var b,h;if(d.visualMode){b=k.getCursor("anchor"),h=k.getCursor("head");if(aK(h,b)){var v=h;h=b,b=v}h.ch=aA(k,h.line)-1}else{var c=Math.max(q.repeat,2);b=k.getCursor(),h=ah(k,cE(b.line+c-1,Infinity))}var p=0;for(var m=b.line;m<h.line;m++){p=aA(k,b.line);var v=cE(b.line+1,aA(k,b.line+1)),j=k.getRange(b,v);j=j.replace(/\n\s*/g," "),k.replaceRange(j,b,v)}var g=cE(b.line,p);d.visualMode&&cg(k,!1),k.setCursor(g)},newLineAndEnterInsertMode:function(d,b,f){f.insertMode=!0;var c=bf(d.getCursor());if(c.line===d.firstLine()&&!b.after){d.replaceRange("\n",cE(d.firstLine(),0)),d.setCursor(d.firstLine(),0)}else{c.line=b.after?c.line:c.line-1,c.ch=aA(d,c.line),d.setCursor(c);var a=bB.commands.newlineAndIndentContinueComment||bB.commands.newlineAndIndent;a(d)}this.enterInsertMode(d,{repeat:b.repeat},f)},paste:function(X,G,M){var J=bf(X.getCursor()),R=cl.registerController.getRegister(G.registerName),H=R.toString();if(!H){return}if(G.matchIndent){var L=X.getOption("tabSize"),F=function(b){var a=b.split("	").length-1,c=b.split(" ").length-1;return a*L+c*1},ar=X.getLine(X.getCursor().line),W=F(ar.match(/^\s*/)[0]),P=H.replace(/\n$/,""),Z=H!==P,U=F(H.match(/^\s*/)[0]),H=P.replace(/^\s*/gm,function(a){var c=W+(F(a)-U);if(c<0){return""}if(X.getOption("indentWithTabs")){var b=Math.floor(c/L);return Array(b+1).join("	")}return Array(c+1).join(" ")});H+=Z?"\n":""}if(G.repeat>1){var H=Array(G.repeat+1).join(H)}var K=R.linewise,Y=R.blockwise;if(K&&!Y){M.visualMode?H=M.visualLine?H.slice(0,-1):"\n"+H.slice(0,H.length-1)+"\n":G.after?(H="\n"+H.slice(0,H.length-1),J.ch=aA(X,J.line)):J.ch=0}else{if(Y){H=H.split("\n");for(var E=0;E<H.length;E++){H[E]=H[E]==""?" ":H[E]}}J.ch+=G.after?1:0}var O,V;if(M.visualMode){M.lastPastedText=H;var A,an=ag(X,M),D=an[0],q=an[1],B=X.getSelection(),j=X.listSelections(),z=(new Array(j.length)).join("1").split("1");M.lastSelection&&(A=M.lastSelection.headMark.find()),cl.registerController.unnamedRegister.setText(B),Y?(X.replaceSelections(z),q=cE(D.line+H.length-1,D.ch),X.setCursor(D),ac(X,q),X.replaceSelections(H),O=D):M.visualBlock?(X.replaceSelections(z),X.setCursor(D),X.replaceRange(H,D,D),O=D):(X.replaceRange(H,D,q),O=X.posFromIndex(X.indexFromPos(D)+H.length-1)),A&&(M.lastSelection.headMark=X.setBookmark(A)),K&&(O.ch=0)}else{if(Y){X.setCursor(J);for(var E=0;E<H.length;E++){var I=J.line+E;I>X.lastLine()&&X.replaceRange("\n",cE(I,0));var Q=aA(X,I);Q<J.ch&&al(X,I,J.ch)}X.setCursor(J),ac(X,cE(J.line+H.length-1,J.ch)),X.replaceSelections(H),O=J}else{X.replaceRange(H,J),K&&G.after?O=cE(J.line+1,ap(X.getLine(J.line+1))):K&&!G.after?O=cE(J.line,ap(X.getLine(J.line))):!K&&G.after?(V=X.indexFromPos(J),O=X.posFromIndex(V+H.length-1)):(V=X.indexFromPos(J),O=X.posFromIndex(V+H.length))}}M.visualMode&&cg(X,!1),X.setCursor(O)},undo:function(b,a){b.operation(function(){ad(b,bB.commands.undo,a.repeat)(),b.setCursor(b.getCursor("anchor"))})},redo:function(b,a){ad(b,bB.commands.redo,a.repeat)()},setRegister:function(b,a,c){c.inputState.registerName=a.selectedCharacter},setMark:function(c,a,d){var b=a.selectedCharacter;cO(c,d,b,c.getCursor())},replace:function(k,q,d){var b=q.selectedCharacter,h=k.getCursor(),v,c,p=k.listSelections();if(d.visualMode){h=k.getCursor("start"),c=k.getCursor("end")}else{var m=k.getLine(h.line);v=h.ch+q.repeat,v>m.length&&(v=m.length),c=cE(h.line,v)}if(b=="\n"){d.visualMode||k.replaceRange("",h,c),(bB.commands.newlineAndIndentContinueComment||bB.commands.newlineAndIndent)(k)}else{var j=k.getRange(h,c);j=j.replace(/[^\n]/g,b);if(d.visualBlock){var g=(new Array(k.getOption("tabSize")+1)).join(" ");j=k.getSelection(),j=j.replace(/\t/g,g).replace(/[^\n]/g,b).split("\n"),k.replaceSelections(j)}else{k.replaceRange(j,h,c)}d.visualMode?(h=aK(p[0].anchor,p[0].head)?p[0].anchor:p[0].head,k.setCursor(h),cg(k,!1)):k.setCursor(c3(c,0,-1))}},incrementNumberToken:function(A,G){var k=A.getCursor(),b=A.getLine(k.line),x=/(-?)(?:(0x)([\da-f]+)|(0b|0|)(\d+))/gi,H,j,F,D;while((H=x.exec(b))!==null){j=H.index,F=j+H[0].length;if(k.ch<F){break}}if(!G.backtrack&&F<=k.ch){return}if(!H){return}var z=H[2]||H[4],w=H[3]||H[5],C=G.increase?1:-1,y={"0b":2,0:8,"":10,"0x":16}[z.toLowerCase()],g=parseInt(H[1]+w,y)+C*G.repeat;D=g.toString(y);var B=z?(new Array(w.length-D.length+1+H[1].length)).join("0"):"";D.charAt(0)==="-"?D="-"+z+B+D.substr(1):D=z+B+D;var E=cE(k.line,j),q=cE(k.line,F);A.replaceRange(D,E,q),A.setCursor(cE(k.line,j+D.length-1))},repeatLastEdit:function(d,b,f){var c=f.lastEditInputState;if(!c){return}var a=b.repeat;a&&b.repeatIsExplicit?f.lastEditInputState.repeatOverride=a:a=f.lastEditInputState.repeatOverride||a,cs(d,f,a,!1)},indent:function(b,a){b.indentLine(b.getCursor().line,a.indentRight)},exitInsertMode:cL},be={"(":"bracket",")":"bracket","{":"bracket","}":"bracket","[":"section","]":"section","*":"comment","/":"comment",m:"method",M:"method","#":"preprocess"},aO={bracket:{isComplete:function(a){if(a.nextCh===a.symb){a.depth++;if(a.depth>=1){return !0}}else{a.nextCh===a.reverseSymb&&a.depth--}return !1}},section:{init:function(a){a.curMoveThrough=!0,a.symb=(a.forward?"]":"[")===a.symb?"{":"}"},isComplete:function(a){return a.index===0&&a.nextCh===a.symb}},comment:{isComplete:function(b){var a=b.lastCh==="*"&&b.nextCh==="/";return b.lastCh=b.nextCh,a}},method:{init:function(a){a.symb=a.symb==="m"?"{":"}",a.reverseSymb=a.symb==="{"?"}":"{"},isComplete:function(a){return a.nextCh===a.symb?!0:!1}},preprocess:{init:function(a){a.index=0},isComplete:function(b){if(b.nextCh==="#"){var a=b.lineText.match(/#(\w+)/)[1];if(a==="endif"){if(b.forward&&b.depth===0){return !0}b.depth++}else{if(a==="if"){if(!b.forward&&b.depth===0){return !0}b.depth--}}if(a==="else"&&b.depth===0){return !0}}return !1}}};cw("pcre",!0,"boolean"),br.prototype={getQuery:function(){return cl.query},setQuery:function(a){cl.query=a},getOverlay:function(){return this.searchOverlay},setOverlay:function(a){this.searchOverlay=a},isReversed:function(){return cl.isReversed},setReversed:function(a){cl.isReversed=a},getScrollbarAnnotate:function(){return this.annotate},setScrollbarAnnotate:function(a){this.annotate=a}};var am={"\\n":"\n","\\r":"\r","\\t":"	"},c6={"\\/":"/","\\\\":"\\","\\n":"\n","\\r":"\r","\\t":"	"},bh="(Javascript regexp)",cv=function(){this.buildCommandMap_()};cv.prototype={processCommand:function(c,a,d){var b=this;c.operation(function(){c.curOp.isVimOp=!0,b._processCommand(c,a,d)})},_processCommand:function(m,w,g){var b=m.state.vim,j=cl.registerController.getRegister(":"),x=j.toString();b.visualMode&&cg(m);var d=new bB.StringStream(w);j.setText(w);var v=g||{};v.input=w;try{this.parseInput_(m,d,v)}catch(q){throw aI(m,q),q}var k,h;if(!v.commandName){v.line!==undefined&&(h="move")}else{k=this.matchCommand_(v.commandName);if(k){h=k.name,k.excludeFromCommandHistory&&j.setText(x),this.parseCommandArgs_(d,v,k);if(k.type=="exToKey"){for(var p=0;p<k.toKeys.length;p++){bB.Vim.handleKey(m,k.toKeys[p],"mapping")}return}if(k.type=="exToEx"){this.processCommand(m,k.toInput);return}}}if(!h){aI(m,'Not an editor command ":'+w+'"');return}try{bi[h](m,v),(!k||!k.possiblyAsync)&&v.callback&&v.callback()}catch(q){throw aI(m,q),q}},parseInput_:function(c,a,d){a.eatWhile(":"),a.eat("%")?(d.line=c.firstLine(),d.lineEnd=c.lastLine()):(d.line=this.parseLineSpec_(c,a),d.line!==undefined&&a.eat(",")&&(d.lineEnd=this.parseLineSpec_(c,a)));var b=a.match(/^(\w+)/);return b?d.commandName=b[1]:d.commandName=a.match(/.*/)[0],d},parseLineSpec_:function(d,b){var f=b.match(/^(\d+)/);if(f){return parseInt(f[1],10)-1}switch(b.next()){case".":return this.parseLineSpecOffset_(b,d.getCursor().line);case"$":return this.parseLineSpecOffset_(b,d.lastLine());case"'":var c=b.next(),a=ae(d,d.state.vim,c);if(!a){throw new Error("Mark not set")}return this.parseLineSpecOffset_(b,a.line);case"-":case"+":return b.backUp(1),this.parseLineSpecOffset_(b,d.getCursor().line);default:return b.backUp(1),undefined}},parseLineSpecOffset_:function(c,a){var d=c.match(/^([+-])?(\d+)/);if(d){var b=parseInt(d[2],10);d[1]=="-"?a-=b:a+=b}return a},parseCommandArgs_:function(d,b,f){if(d.eol()){return}b.argString=d.match(/.*/)[0];var c=f.argDelimiter||/\s+/,a=cP(b.argString).split(c);a.length&&a[0]&&(b.args=a)},matchCommand_:function(c){for(var a=c.length;a>0;a--){var d=c.substring(0,a);if(this.commandMap_[d]){var b=this.commandMap_[d];if(b.name.indexOf(c)===0){return b}}}return null},buildCommandMap_:function(){this.commandMap_={};for(var b=0;b<bz.length;b++){var a=bz[b],c=a.shortName||a.name;this.commandMap_[c]=a}},map:function(d,b,f){if(d!=":"&&d.charAt(0)==":"){if(f){throw Error("Mode not supported for ex mappings")}var c=d.substring(1);b!=":"&&b.charAt(0)==":"?this.commandMap_[c]={name:c,type:"exToEx",toInput:b.substring(1),user:!0}:this.commandMap_[c]={name:c,type:"exToKey",toKeys:b,user:!0}}else{if(b!=":"&&b.charAt(0)==":"){var a={keys:d,type:"keyToEx",exArgs:{input:b.substring(1)}};f&&(a.context=f),b2.unshift(a)}else{var a={keys:d,type:"keyToKey",toKeys:b};f&&(a.context=f),b2.unshift(a)}}},unmap:function(d,b){if(d!=":"&&d.charAt(0)==":"){if(b){throw Error("Mode not supported for ex mappings")}var f=d.substring(1);if(this.commandMap_[f]&&this.commandMap_[f].user){delete this.commandMap_[f];return}}else{var c=d;for(var a=0;a<b2.length;a++){if(c==b2[a].keys&&b2[a].context===b){b2.splice(a,1);return}}}}};var bi={colorscheme:function(b,a){if(!a.args||a.args.length<1){aI(b,b.getOption("theme"));return}b.setOption("theme",a.args[0])},map:function(c,a,d){var b=a.args;if(!b||b.length<2){c&&aI(c,"Invalid mapping: "+a.input);return}ai.map(b[0],b[1],d)},imap:function(b,a){this.map(b,a,"insert")},nmap:function(b,a){this.map(b,a,"normal")},vmap:function(b,a){this.map(b,a,"visual")},unmap:function(c,a,d){var b=a.args;if(!b||b.length<1){c&&aI(c,"No such mapping: "+a.input);return}ai.unmap(b[0],d)},move:function(b,a){aG.processCommand(b,b.state.vim,{type:"motion",motion:"moveToLineOrEdgeOfDocument",motionArgs:{forward:!1,explicitRepeat:!0,linewise:!0},repeatOverride:a.line+1})},set:function(k,q){var d=q.args,b=q.setCfg||{};if(!d||d.length<1){k&&aI(k,"Invalid mapping: "+q.input);return}var h=d[0].split("="),v=h[0],c=h[1],p=!1;if(v.charAt(v.length-1)=="?"){if(c){throw Error("Trailing characters: "+q.argString)}v=v.substring(0,v.length-1),p=!0}c===undefined&&v.substring(0,2)=="no"&&(v=v.substring(2),c=!1);var m=cx[v]&&cx[v].type=="boolean";m&&c==undefined&&(c=!0);if(!m&&c===undefined||p){var j=cB(v,k,b);j instanceof Error?aI(k,j.message):j===!0||j===!1?aI(k," "+(j?"":"no")+v):aI(k,"  "+v+"="+j)}else{var g=ci(v,c,k,b);g instanceof Error&&aI(k,g.message)}},setlocal:function(b,a){a.setCfg={scope:"local"},this.set(b,a)},setglobal:function(b,a){a.setCfg={scope:"global"},this.set(b,a)},registers:function(g,k){var d=k.args,b=cl.registerController.registers,f="----------Registers----------<br><br>";if(!d){for(var l in b){var c=b[l].toString();c.length&&(f+='"'+l+"    "+c+"<br>")}}else{var l;d=d.join("");for(var j=0;j<d.length;j++){l=d.charAt(j);if(!cl.registerController.isValidRegister(l)){continue}var h=b[l]||new cM;f+='"'+l+"    "+h.toString()+"<br>"}}aI(g,f)},sort:function(P,C){function B(){if(C.argString){var h=new bB.StringStream(C.argString);h.eat("!")&&(H=!0);if(h.eol()){return}if(!h.eatSpace()){return"Invalid arguments"}var d=h.match(/([dinuox]+)?\s*(\/.+\/)?\s*/);if(!d&&!h.eol()){return"Invalid arguments"}if(d[1]){E=d[1].indexOf("i")!=-1,K=d[1].indexOf("u")!=-1;var c=d[1].indexOf("d")!=-1||d[1].indexOf("n")!=-1&&1,g=d[1].indexOf("x")!=-1&&1,b=d[1].indexOf("o")!=-1&&1;if(c+g+b>1){return"Invalid arguments"}D=c&&"decimal"||g&&"hex"||b&&"octal"}d[2]&&(G=new RegExp(d[2].substr(1,d[2].length-2),E?"i":""))}}function k(d,c){if(H){var b;b=d,d=c,c=b}E&&(d=d.toLowerCase(),c=c.toLowerCase());var f=D&&Q.exec(d),a=D&&Q.exec(c);return f?(f=parseInt((f[1]+f[2]).toLowerCase(),I),a=parseInt((a[1]+a[2]).toLowerCase(),I),f-a):d<c?-1:1}function z(c,b){if(H){var a;a=c,c=b,b=a}return E&&(c[0]=c[0].toLowerCase(),b[0]=b[0].toLowerCase()),c[0]<b[0]?-1:1}var H,E,K,D,G,V=B();if(V){aI(P,V+": "+C.argString);return}var O=C.line||P.firstLine(),J=C.lineEnd||C.line||P.lastLine();if(O==J){return}var R=cE(O,0),L=cE(J,aA(P,J)),F=P.getRange(R,L).split("\n"),Q=G?G:D=="decimal"?/(-?)([\d]+)/:D=="hex"?/(-?)(?:0x)?([0-9a-f]+)/i:D=="octal"?/([0-7]+)/:null,I=D=="decimal"?10:D=="hex"?16:D=="octal"?8:null,M=[],v=[];if(D||G){for(var U=0;U<F.length;U++){var A=G?F[U].match(G):null;A&&A[0]!=""?M.push(A):!G&&Q.exec(F[U])?M.push(F[U]):v.push(F[U])}}else{v=F}M.sort(G?z:k);if(G){for(var U=0;U<M.length;U++){M[U]=M[U].input}}else{D||v.sort(k)}F=H?M.concat(v):v.concat(M);if(K){var j=F,q;F=[];for(var U=0;U<j.length;U++){j[U]!=q&&F.push(j[U]),q=j[U]}}P.replaceRange(F.join("\n"),R,L)},global:function(y,E){var k=E.argString;if(!k){aI(y,"Regular Expression missing from global");return}var b=E.line!==undefined?E.line:y.firstLine(),q=E.lineEnd||E.line||y.lastLine(),F=cS(k),j=k,D;F.length&&(j=F[0],D=F.slice(1,F.length).join("/"));if(j){try{a8(y,j,!0,!0)}catch(B){aI(y,"Invalid regex: "+j);return}}var x=bm(y).getQuery(),m=[],A="";for(var w=b;w<=q;w++){var g=x.test(y.getLine(w));g&&(m.push(w+1),A+=y.getLine(w)+"<br>")}if(!D){aI(y,A);return}var z=0,C=function(){if(z<m.length){var a=m[z]+D;ai.processCommand(y,a,{callback:C})}z++};C()},substitute:function(G,k){if(!G.getSearchCursor){throw new Error("Search feature not available. Requires searchcursor.js or any other getSearchCursor implementation.")}var z=k.argString,w=z?cX(z,z[0]):[],C,q="",y,j,J,F=!1,B=!1;if(w.length){C=w[0],q=w[1],C&&C[C.length-1]==="$"&&(C=C.slice(0,C.length-1)+"\\n",q=q?q+"\n":"\n"),q!==undefined&&(cB("pcre")?q=cW(q):q=c5(q),cl.lastSubstituteReplacePart=q),y=w[2]?w[2].split(" "):[]}else{if(z&&z.length){aI(G,"Substitutions should be of the form :s/pattern/replace/");return}}y&&(j=y[0],J=parseInt(y[1]),j&&(j.indexOf("c")!=-1&&(F=!0,j.replace("c","")),j.indexOf("g")!=-1&&(B=!0,j.replace("g","")),C=C.replace(/\//g,"\\/")+"/"+j));if(C){try{a8(G,C,!0,!0)}catch(I){aI(G,"Invalid regex: "+C);return}}q=q||cl.lastSubstituteReplacePart;if(q===undefined){aI(G,"No previous substitute regular expression");return}var D=bm(G),x=D.getQuery(),H=k.line!==undefined?k.line:G.getCursor().line,b=k.lineEnd||H;H==G.firstLine()&&b==G.lastLine()&&(b=Infinity),J&&(H=b,b=H+J-1);var A=ah(G,cE(H,0)),E=G.getSearchCursor(x,A);cK(G,F,B,H,b,E,x,q,k.callback)},redo:bB.commands.redo,undo:bB.commands.undo,write:function(a){bB.commands.save?bB.commands.save(a):a.save&&a.save()},nohlsearch:function(a){cR(a)},yank:function(c){var a=bf(c.getCursor()),d=a.line,b=c.getLine(d);cl.registerController.pushText("0","yank",b,!0,!0)},delmarks:function(m,w){if(!w.argString||!cP(w.argString)){aI(m,"Argument required");return}var g=m.state.vim,b=new bB.StringStream(cP(w.argString));while(!b.eol()){b.eatSpace();var j=b.pos;if(!b.match(/[a-zA-Z]/,!1)){aI(m,"Invalid argument: "+w.argString.substring(j));return}var x=b.next();if(b.match("-",!0)){if(!b.match(/[a-zA-Z]/,!1)){aI(m,"Invalid argument: "+w.argString.substring(j));return}var d=x,v=b.next();if(!(cc(d)&&cc(v)||b9(d)&&b9(v))){aI(m,"Invalid argument: "+d+"-");return}var q=d.charCodeAt(0),k=v.charCodeAt(0);if(q>=k){aI(m,"Invalid argument: "+w.argString.substring(j));return}for(var h=0;h<=k-q;h++){var p=String.fromCharCode(q+h);delete g.marks[p]}}else{delete g.marks[x]}}}},ai=new cv;bB.keyMap.vim={attach:cH,detach:co,call:bQ},cw("insertModeEscKeysTimeout",200,"number"),bB.keyMap["vim-insert"]={"Ctrl-N":"autocomplete","Ctrl-P":"autocomplete",Enter:function(b){var a=bB.commands.newlineAndIndentContinueComment||bB.commands.newlineAndIndent;a(b)},fallthrough:["default"],attach:cH,detach:co,call:bQ},bB.keyMap["vim-replace"]={Backspace:"goCharLeft",fallthrough:["vim-insert"],attach:cH,detach:co,call:bQ},a6(),bB.Vim=cf(),cf=bB.Vim;var ay={"return":"CR",backspace:"BS","delete":"Del",esc:"Esc",left:"Left",right:"Right",up:"Up",down:"Down",space:"Space",home:"Home",end:"End",pageup:"PageUp",pagedown:"PageDown",enter:"CR"},bO=cf.handleKey.bind(cf);cf.handleKey=function(b,a,c){return b.operation(function(){return bO(b,a,c)},!0)},bD.CodeMirror=bB;var a2=cf.maybeInitVimState_;bD.handler={$id:"ace/keyboard/vim",drawCursor:function(j,q,g,b,v){var d=this.state.vim||{},p=g.characterWidth,m=g.lineHeight,i=q.top,h=q.left;if(!d.insertMode){var k=b.cursor?bT.comparePoints(b.cursor,b.start)<=0:v.selection.isBackwards()||v.selection.isEmpty();!k&&h>p&&(h-=p)}!d.insertMode&&d.status&&(m/=2,i+=m),j.left=h+"px",j.top=i+"px",j.width=p+"px",j.height=m+"px"},handleKeyboard:function(v,y,g,b,k){var z=v.editor,d=z.state.cm,x=a2(d);if(b==-1){return}x.insertMode||(y==-1?(g.charCodeAt(0)>255&&v.inputKey&&(g=v.inputKey,g&&v.inputHash==4&&(g=g.toUpperCase())),v.inputChar=g):y==4||y==0?v.inputKey==g&&v.inputHash==y&&v.inputChar?(g=v.inputChar,y=-1):(v.inputChar=null,v.inputKey=g,v.inputHash=y):v.inputChar=v.inputKey=null);if(g=="c"&&y==1&&!b1.isMac&&z.getCopyText()){return z.once("copy",function(){z.selection.clearSelection()}),{command:"null",passEvent:!0}}if(g=="esc"&&!x.insertMode&&!x.visualMode&&!d.ace.inMultiSelectMode){var w=bm(d),q=w.getOverlay();q&&d.removeOverlay(q)}if(y==-1||y&1||y===0&&g.length>1){var j=x.insertMode,m=aV(y,g,k||{});x.status==null&&(x.status="");var c=cN(d,m,"user");x=a2(d),c&&x.status!=null?x.status+=m:x.status==null&&(x.status=""),d._signal("changeStatus");if(!c&&(y!=-1||j)){return}return{command:"null",passEvent:!c}}},attach:function(b){function c(){var d=a2(a).insertMode;a.ace.renderer.setStyle("normal-mode",!d),b.textInput.setCommandMode(!d),b.renderer.$keepTextAreaAtCursor=d,b.renderer.$blockCursor=!d}b.state||(b.state={});var a=new bB(b);b.state.cm=a,b.$vimModeHandler=this,bB.keyMap.vim.attach(a),a2(a).status=null,a.on("vim-command-done",function(){if(a.virtualSelectionMode()){return}a2(a).status=null,a.ace._signal("changeStatus"),a.ace.session.markUndoGroup()}),a.on("changeStatus",function(){a.ace.renderer.updateCursor(),a.ace._signal("changeStatus")}),a.on("vim-mode-change",function(){if(a.virtualSelectionMode()){return}c(),a._signal("changeStatus")}),c(),b.renderer.$cursorLayer.drawCursor=this.drawCursor.bind(a),this.updateMacCompositionHandlers(b,!0)},detach:function(b){var a=b.state.cm;bB.keyMap.vim.detach(a),a.destroy(),b.state.cm=null,b.$vimModeHandler=null,b.renderer.$cursorLayer.drawCursor=null,b.renderer.setStyle("normal-mode",!1),b.textInput.setCommandMode(!1),b.renderer.$keepTextAreaAtCursor=!0,this.updateMacCompositionHandlers(b,!1)},getStatusText:function(c){var a=c.state.cm,d=a2(a);if(d.insertMode){return"INSERT"}var b="";return d.visualMode&&(b+="VISUAL",d.visualLine&&(b+=" LINE"),d.visualBlock&&(b+=" BLOCK")),d.status&&(b+=(b?" ":"")+d.status),b},updateMacCompositionHandlers:function(c,a){var d=function(f){var h=c.state.cm,g=a2(h);if(!g.insertMode){var e=this.textInput.getElement();e.blur(),e.focus(),e.value=f}else{this.onCompositionUpdateOrig(f)}},b=function(e){var g=c.state.cm,f=a2(g);f.insertMode&&this.onCompositionStartOrig(e)};a?c.onCompositionUpdateOrig||(c.onCompositionUpdateOrig=c.onCompositionUpdate,c.onCompositionUpdate=d,c.onCompositionStartOrig=c.onCompositionStart,c.onCompositionStart=b):c.onCompositionUpdateOrig&&(c.onCompositionUpdate=c.onCompositionUpdateOrig,c.onCompositionUpdateOrig=null,c.onCompositionStart=c.onCompositionStartOrig,c.onCompositionStartOrig=null)}};var c0={getText:function(b,a){return(Math.abs(b.selection.lead.row-a)||a+1+(a<9?"\u00b7":""))+""},getWidth:function(b,a,c){return b.getLength().toString().length*c.characterWidth},update:function(b,a){a.renderer.$loop.schedule(a.renderer.CHANGE_GUTTER)},attach:function(a){a.renderer.$gutterLayer.$renderer=this,a.on("changeSelection",this.update)},detach:function(a){a.renderer.$gutterLayer.$renderer=null,a.off("changeSelection",this.update)}};cf.defineOption({name:"wrap",set:function(b,a){a&&a.ace.setOption("wrap",b)},type:"boolean"},!1),cf.defineEx("write","w",function(){console.log(":write is not implemented")}),b2.push({keys:"zc",type:"action",action:"fold",actionArgs:{open:!1}},{keys:"zC",type:"action",action:"fold",actionArgs:{open:!1,all:!0}},{keys:"zo",type:"action",action:"fold",actionArgs:{open:!0}},{keys:"zO",type:"action",action:"fold",actionArgs:{open:!0,all:!0}},{keys:"za",type:"action",action:"fold",actionArgs:{toggle:!0}},{keys:"zA",type:"action",action:"fold",actionArgs:{toggle:!0,all:!0}},{keys:"zf",type:"action",action:"fold",actionArgs:{open:!0,all:!0}},{keys:"zd",type:"action",action:"fold",actionArgs:{open:!0,all:!0}},{keys:"<C-A-k>",type:"action",action:"aceCommand",actionArgs:{name:"addCursorAbove"}},{keys:"<C-A-j>",type:"action",action:"aceCommand",actionArgs:{name:"addCursorBelow"}},{keys:"<C-A-S-k>",type:"action",action:"aceCommand",actionArgs:{name:"addCursorAboveSkipCurrent"}},{keys:"<C-A-S-j>",type:"action",action:"aceCommand",actionArgs:{name:"addCursorBelowSkipCurrent"}},{keys:"<C-A-h>",type:"action",action:"aceCommand",actionArgs:{name:"selectMoreBefore"}},{keys:"<C-A-l>",type:"action",action:"aceCommand",actionArgs:{name:"selectMoreAfter"}},{keys:"<C-A-S-h>",type:"action",action:"aceCommand",actionArgs:{name:"selectNextBefore"}},{keys:"<C-A-S-l>",type:"action",action:"aceCommand",actionArgs:{name:"selectNextAfter"}}),cU.aceCommand=function(b,a,c){b.vimCmd=a,b.ace.inVirtualSelectionMode?b.ace.on("beforeEndOperation",bA):bA(null,b.ace)},cU.fold=function(b,a,c){b.ace.execCommand(["toggleFoldWidget","toggleFoldWidget","foldOther","unfoldall"][(a.all?2:0)+(a.open?1:0)])},bD.handler.defaultKeymap=b2,bD.handler.actions=cU,bD.Vim=cf,cf.map("Y","yy","normal")});(function(){window.require(["ace/keyboard/vim"],function(a){if(typeof module=="object"&&typeof exports=="object"&&module){module.exports=a}})})();